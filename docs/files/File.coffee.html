<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>File.coffee - Magister.js Docs</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="http://i.imgur.com/Lrg80ax.png" title="Magister.js Docs"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.21.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AbsenceInfo.html">AbsenceInfo</a></li>
                                <li><a href="../classes/AddressInfo.html">AddressInfo</a></li>
                                <li><a href="../classes/Appointment.html">Appointment</a></li>
                                <li><a href="../classes/Assignment.html">Assignment</a></li>
                                <li><a href="../classes/AssignmentVersion.html">AssignmentVersion</a></li>
                                <li><a href="../classes/Class.html">Class</a></li>
                                <li><a href="../classes/Course.html">Course</a></li>
                                <li><a href="../classes/DigitalSchoolUtility.html">DigitalSchoolUtility</a></li>
                                <li><a href="../classes/File.html">File</a></li>
                                <li><a href="../classes/FileFolder.html">FileFolder</a></li>
                                <li><a href="../classes/Grade.html">Grade</a></li>
                                <li><a href="../classes/GradePeriod.html">GradePeriod</a></li>
                                <li><a href="../classes/GradeType.html">GradeType</a></li>
                                <li><a href="../classes/Magister.html">Magister</a></li>
                                <li><a href="../classes/MagisterSchool.html">MagisterSchool</a></li>
                                <li><a href="../classes/Message.html">Message</a></li>
                                <li><a href="../classes/MessageFolder.html">MessageFolder</a></li>
                                <li><a href="../classes/Person.html">Person</a></li>
                                <li><a href="../classes/ProfileInfo.html">ProfileInfo</a></li>
                                <li><a href="../classes/ProfileSettings.html">ProfileSettings</a></li>
                                <li><a href="../classes/StudyGuide.html">StudyGuide</a></li>
                                <li><a href="../classes/StudyGuidePart.html">StudyGuidePart</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/Magister.html">Magister</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: File.coffee</h1>

<div class="file">
    <pre class="code prettyprint linenums">
root = (module?.exports ? this.Magister ?= {})

###*
# A folder containing File instances.
#
# @class FileFolder
# @private
# @param _magisterObj {Magister} A Magister object this FileFolder is child of.
# @constructor
###
class root.FileFolder
	constructor: (@_magisterObj) -&gt;
		###*
		# @property id
		# @final
		# @type Number
		###
		@id = root._getset &quot;_id&quot;
		###*
		# @property name
		# @final
		# @type String
		###
		@name = root._getset &quot;_name&quot;
		###*
		# The rights the current user has on this FileFolder.
		# @property rights
		# @final
		# @type Number
		###
		@rights = root._getset &quot;_rights&quot;
		###*
		# The ID of the parent FileFolder of this FileFolder.
		# @property parentId
		# @final
		# @type Number
		###
		@parentId = root._getset &quot;_parentId&quot;

	###*
	# Gets all the files in the current FileFolder.
	#
	# @method files
	# @async
	# @param callback {Function} A standard callback.
	# 	@param [callback.error] {Object} The error, if it exists.
	# 	@param [callback.result] {File[]} The results as an Array.
	###
	files: (callback) -&gt;
		@_magisterObj.http.get &quot;#{@_magisterObj._personUrl}/bronnen?parentId=#{@id()}&quot;, {}, (error, result) =&gt;
			if error? then callback error, null
			else
				files = (root.File._convertRaw @_magisterObj, this, f for f in JSON.parse(result.content).Items)
				pushResult = root._helpers.asyncResultWaiter files.length, (r) -&gt; callback null, files

				for f in files
					do (f) =&gt; @_magisterObj.getPersons f.GeplaatstDoor, (e, r) -&gt;
						unless e? or r.length is 0 then f._addedBy = r[0]
						pushResult()

	@_convertRaw: (magisterObj, raw) -&gt;
		obj = new root.FileFolder magisterObj

		obj._id = raw.Id
		obj._name = raw.Naam
		obj._rights = raw.Privilege
		obj._parentId = raw.ParentId

		obj

###*
# A file from Magister, can be downloaded.
#
# @class File
# @private
# @param _magisterObj {Magister} A Magister object this File is child of.
# @constructor
###
class root.File
	constructor: (@_magisterObj) -&gt;
		###*
		# @property id
		# @final
		# @type String
		###
		@id = root._getset &quot;_id&quot;
		###*
		# @property type
		# @final
		# @type Number
		###
		@type = root._getset &quot;_type&quot;
		###*
		# @property name
		# @type String
		###
		@name = root._getset &quot;_name&quot;, (x) =&gt; @_name = x; @_update()
		###*
		# @property uri
		# @final
		# @type String
		###
		@uri = root._getset &quot;_uri&quot;
		###*
		# The size of this file in bytes.
		# @property size
		# @final
		# @type Number
		###
		@size = root._getset &quot;_size&quot;
		###*
		# The rights the current user has on this File.
		# @property rights
		# @final
		# @type Number
		###
		@rights = root._getset &quot;_rights&quot;
		###*
		# @property mime
		# @final
		# @type String
		###
		@mime = root._getset &quot;_mime&quot;
		###*
		# @property changedDate
		# @final
		# @type Date|undefined
		###
		@changedDate = root._getset &quot;_changedDate&quot;
		###*
		# @property creationDate
		# @final
		# @type Date|undefined
		###
		@creationDate = root._getset &quot;_creationDate&quot;
		###*
		# @property addedBy
		# @final
		# @type Person
		###
		@addedBy = root._getset &quot;_addedBy&quot;
		###*
		# @property fileBlobId
		# @final
		# @type String|undefined
		###
		@fileBlobId = root._getset &quot;_fileBlobId&quot;
		###*
		# The FileFolder this File is in.
		# @property fileFolder
		# @type FileFolder
		###
		@fileFolder = root._getset &quot;_fileFolder&quot;, @move
		###*
		# @property uniqueId
		# @final
		# @type String
		###
		@uniqueId = root._getset &quot;_uniqueId&quot;
		###*
		# @property referenceId
		# @final
		# @type String|undefined
		###
		@referenceId = root._getset &quot;_referenceId&quot;

	###*
	# Downloads the current file
	# Currently only accessible from the server.
	#
	# @method download
	# @async
	# @param [fileName=true] {Boolean|String} Whether or not to download the file directly. If &#x60;downloadFile&#x60; is a truely string the file will be downloaded in with the name set to the string&#x27;s content.
	# @param [callback] {Function} A standard callback.
	# 	@param [callback.error] {Object} The error, if it exists.
	# 	@param [callback.result] {String} A string containing the base64 encoded binary data of the downloaded file.
	###
	download: -&gt;
		fileName = _.find(arguments, (a) -&gt; _.isString(a) or _.isBoolean(a)) ? yes
		callback = _.find arguments, (a) -&gt; _.isFunction a

		if Meteor?.isServer
			request = Npm.require &#x27;request&#x27;
			fs = Npm.require &#x27;fs&#x27;
		else if module?.exports?
			request = require &#x27;request&#x27;
			fs = require &#x27;fs&#x27;
		else
			callback? new Error(&#x27;&#x60;File.download&#x60; is only accessible from the server at the moment.\nYou can set a proxy yourself with something like iron:router serverside routes.&#x27;), null
			return undefined

		fileName = (
			if _.isBoolean(fileName) and fileName
				@name()
			else if _.isString fileName
				if /(\.{1,2}\/?)*$/.test fileName
					fileName += &quot;/#{@name()}&quot;
				else
					fileName
			else
				undefined
		)

		req = request(
			url: @_downloadUrl
			method: &#x27;GET&#x27;
			headers: @_magisterObj.http._cookieInserter()
			encoding: null
		)
			.on &#x27;error&#x27;, (err) -&gt; callback? err, null
			.on &#x27;response&#x27;, (res) -&gt; callback? null, &#x27;&#x27;

		if fileName?
			req.pipe require(&#x27;fs&#x27;).createWriteStream fileName

		undefined

	###*
	# Moves the current File to another FileFolder
	#
	# @method move
	# @param fileFolder {FileFolder|Number|String} A FileFolder, an ID of a FileFolder or (a part of) the name of a FileFolder.
	###
	move: (fileFolder) -&gt;
		@_magisterObj.fileFolders (e, r) =&gt;
			throw e if e?
			unless _.isObject fileFolder
				fileFolder = _.find r, (f) -&gt; root._helpers.contains(f.name(), fileFolder, yes) or f.id() is fileFolder

			@_fileFolder = fileFolder
			@_update()

	###*
	# WARNING. Removes the current File.
	#
	# @method remove
	###
	remove: -&gt; @_magisterObj.http.delete &quot;#{@_magisterObj._personUrl}/bronnen/#{@id()}&quot;, {}, (error, result) -&gt; throw error if error?

	###*
	# Updates the current File on the Magister servers.
	#
	# @private
	# @method _update
	###
	_update: -&gt; @_magisterObj.http.put &quot;#{@_magisterObj._personUrl}/bronnen/#{@id()}&quot;, @_toMagisterStyle(), {}, (-&gt;)

	_toMagisterStyle: -&gt;
		obj = {}

		obj.Id = parseInt @_id, 10
		obj.BronSoort = @_type
		obj.Naam = @_name
		obj.Uri = @_uri
		obj.Grootte = @_size
		obj.Privilege = @_rights
		obj.ContentType = @_mime
		obj.FileBlobId = if @_fileBlobId? then parseInt @_fileBlobId, 10
		obj.ParentId = @_fileFolder.id()
		obj.UniqueId = @_uniqueId
		obj.Referentie = if @_referenceId? then parseInt @_referenceId, 10

		obj

	@_convertRaw: (magisterObj, fileFolder, raw) -&gt;
		if raw._addedBy? then addedBy = raw._addedBy
		else
			addedBy = new root.Person magisterObj, null, &quot;&quot;, &quot;&quot;
			addedBy._fullName = raw.GeplaatstDoor

		obj = new root.File magisterObj

		obj._id = raw.Id.toString()
		obj._type = raw.BronSoort
		obj._name = raw.Naam
		obj._uri = raw.Uri
		obj._size = raw.Grootte
		obj._rights = raw.Privilege
		obj._mime = raw.ContentType

		obj._changedDate = root._helpers.parseDate raw.GewijzigdOp
		obj._creationDate = root._helpers.parseDate (raw.GemaaktOp ? raw.Datum)

		obj._addedBy = addedBy
		obj._fileBlobId = raw.FileBlobId?.toString()
		obj._fileFolder = fileFolder
		obj._uniqueId = raw.UniqueId
		obj._referenceId = raw.Referentie?.toString()

		l = _.find raw.Links, Rel: &#x27;Contents&#x27;
		l ?= _.find raw.Links, Rel: &#x27;Self&#x27;
		if /^https?/.test l.Href
			obj._downloadUrl = l.Href
		else
			obj._downloadUrl = magisterObj.magisterSchool.url + l.Href

		obj

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
