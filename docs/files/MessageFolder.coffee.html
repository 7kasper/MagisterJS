<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>MessageFolder.coffee - Magister.js Docs</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="http://i.imgur.com/Lrg80ax.png" title="Magister.js Docs"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.13.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AbsenceInfo.html">AbsenceInfo</a></li>
                                <li><a href="../classes/AddressInfo.html">AddressInfo</a></li>
                                <li><a href="../classes/Appointment.html">Appointment</a></li>
                                <li><a href="../classes/Assignment.html">Assignment</a></li>
                                <li><a href="../classes/AssignmentVersion.html">AssignmentVersion</a></li>
                                <li><a href="../classes/Class.html">Class</a></li>
                                <li><a href="../classes/Course.html">Course</a></li>
                                <li><a href="../classes/DigitalSchoolUtility.html">DigitalSchoolUtility</a></li>
                                <li><a href="../classes/ExtraProfileInfo.html">ExtraProfileInfo</a></li>
                                <li><a href="../classes/File.html">File</a></li>
                                <li><a href="../classes/FileFolder.html">FileFolder</a></li>
                                <li><a href="../classes/Grade.html">Grade</a></li>
                                <li><a href="../classes/GradePeriod.html">GradePeriod</a></li>
                                <li><a href="../classes/GradeType.html">GradeType</a></li>
                                <li><a href="../classes/Magister.html">Magister</a></li>
                                <li><a href="../classes/MagisterSchool.html">MagisterSchool</a></li>
                                <li><a href="../classes/Message.html">Message</a></li>
                                <li><a href="../classes/MessageFolder.html">MessageFolder</a></li>
                                <li><a href="../classes/Person.html">Person</a></li>
                                <li><a href="../classes/ProfileInfo.html">ProfileInfo</a></li>
                                <li><a href="../classes/StudyGuide.html">StudyGuide</a></li>
                                <li><a href="../classes/StudyGuidePart.html">StudyGuidePart</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/Magister.html">Magister</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: MessageFolder.coffee</h1>

<div class="file">
    <pre class="code prettyprint linenums">
root = (module?.exports ? this.Magister ?= {})

findQueries = (queries) -&gt;
	final = &quot;&quot;

	if _.any([&quot;unread&quot;, &quot;ongelezen&quot;], (x) -&gt; root._helpers.contains queries, x, yes)
		final += &quot;&amp;gelezen=false&quot;
	else if _.any([&quot;read&quot;, &quot;gelezen&quot;], (x) -&gt; root._helpers.contains queries, x, yes)
		final += &quot;&amp;gelezen=true&quot;

	if (result = /(skip \d+)|(sla \d+ over)/ig.exec(queries))?
		numbers = /\d+/.exec(result[0])[0]
		final += &quot;&amp;skip=#{numbers}&quot;

	return final

###*
# A MessageFolder.
#
# @class MessageFolder
# @private
# @param _magisterObj {Magister} A Magister object this MessageFolder is child of.
# @constructor
###
class root.MessageFolder
	constructor: (@_magisterObj) -&gt;
		###*
		# @property name
		# @final
		# @type String
		###
		@name = root._getset &quot;_name&quot;
		###*
		# @property unreadMessagesCount
		# @final
		# @type Number
		###
		@unreadMessagesCount = root._getset &quot;_unreadMessagesCount&quot;
		###*
		# @property id
		# @final
		# @type Number
		###
		@id = root._getset &quot;_id&quot;
		###*
		# @property parentId
		# @final
		# @type Number
		###
		@parentId = root._getset &quot;_parentId&quot;

	###*
	# Gets the Messages of this MessageFolder.
	#
	# @method messages
	# @async
	# @param [limit=10] {Number} The limit of the amount of Messages to fetch.
	# @param [queries=&quot;&quot;] {String} Queries to do on the message (e.g: &quot;unread, skip 5&quot;)
	# @param [fillPersons=false] {Boolean} Whether or not to download the users from the server.
	# @param callback {Function} A standard callback.
	# 	@param [callback.error] {Object} The error, if it exists.
	# 	@param [callback.result] {Message[]} An array containing the Messages.
	###
	messages: -&gt;
		limit = _.find(arguments, (a) -&gt; _.isNumber a) ? 10
		queries = _.find(arguments, (a) -&gt; _.isString a) ? &quot;&quot;
		fillPersons = _.find(arguments, (a) -&gt; _.isBoolean a) ? no

		callback = _.find(arguments, (a) -&gt; _.isFunction a)
		throw new Error(&quot;Callback is null&quot;) unless callback?

		if limit is 0
			callback null, []
			return undefined

		url = &quot;#{@_magisterObj._personUrl}/berichten?mapId=#{@id()}&amp;top=#{limit}#{findQueries queries}&quot;

		@_magisterObj.http.get url, {}, (error, result) =&gt;
			if error?
				callback error, null
			else
				messages = ( root.Message._convertRaw(@_magisterObj, m) for m in JSON.parse(result.content).Items )
				pushMessage = root._helpers.asyncResultWaiter messages.length, (r) -&gt; callback null, _.sortBy(r, (m) -&gt; m.sendDate()).reverse()

				for m in messages
					do (m) =&gt;
						url = &quot;#{@_magisterObj._personUrl}/berichten/#{m.id()}?berichtSoort=#{m.type()}&quot;
						@_magisterObj.http.get url, {}, (error, result) =&gt;
							parsed = JSON.parse(result.content)
							m._body = parsed.Inhoud
							m._attachments = (root.File._convertRaw(@_magisterObj, undefined, a) for a in (parsed.Bijlagen ? []))

							if fillPersons
								pushPeople = root._helpers.asyncResultWaiter m.recipients().length + 1, -&gt; pushMessage m

								@_magisterObj.fillPersons m.recipients(), (e, r) -&gt;
									m._recipients = r
									pushPeople r
								@_magisterObj.fillPersons m.sender(), (e, r) -&gt;
									m._sender = r
									pushPeople r
							else
								pushMessage m

			undefined

	###*
	# Gets the MessageFolders in this MessageFolder that matches the given query. Or if no query is given, all MessageFolders
	#
	# @method messageFolders
	# @async
	# @param query {String} A case insensetive query the MessageFolder need to match.
	# @param callback {Function} A standard callback.
	# 	@param [callback.error] {Object} The error, if it exists.
	#	@param [callback.result] {MessageFolder[]} An array containing the matching MessageFolders.
	# @return {MessageFolder[]} An array containing the matching messageFolders.
	###
	messageFolders: (query, callback) -&gt;
		callback = (if callback? then callback else query) ? (-&gt;)
		return unless callback?
		@_magisterObj.http.get &quot;#{@_magisterObj._personUrl}/berichten/mappen?parentId=#{@id()}&quot;, {},
			(error, result) =&gt;
				if error?
					callback error, null
				else
					messageFolders = (root.MessageFolder._convertRaw(@_magisterObj, mF) for mF in JSON.parse(result.content).Items)

					if _.isString(query) and query isnt &quot;&quot;
						result = _.where messageFolders, (mF) -&gt; Helpers.contains mF.name(), query, yes
					else
						result = messageFolders

					callback null, result

	###*
	# DANGER. Removes ALL messages from the current MessageFolder.
	# @method removeAllMessages
	###
	removeAllMessages: -&gt; @_magisterObj.http.delete &quot;#{@_magisterObj._personUrl}/berichten/map/#{@id()}&quot;, {}, (e, r) -&gt; throw e if e?

	###*
	# Creates a new MessageFolder inside of this MessageFolder with the given name.
	#
	# @method createMessageFolder
	# @async
	# @param name {String} The name of the MessageFolder.
	# @param callback {Function} A standard callback.
	# 	@param [callback.error] {Object} The error, if it exists.
	#	@param [callback.result] {MessageFolder} The new MessageFolder.
	###
	createMessageFolder: (name, callback = (-&gt;)) -&gt;
		folder =
			naam: name
			parentId: @id()
			persoonId: @_magisterObj._id

		@_magisterObj.http.post &quot;#{@_magisterObj._personUrl}/berichten/mappen&quot;, folder, {}, (error, result) =&gt;
			if error? then callback error, null
			else callback null, root.MessageFolder._convertRaw @_magisterObj, JSON.parse(result.content)

	# TODO: Doesn&#x27;t work!
	###*
	# DANGER. Removes the current MessageFolder.
	# @method remove
	###
	remove: -&gt; @_magisterObj.http.put &quot;#{@_magisterObj._personUrl}/berichten/mappen&quot;, @_toMagisterStyle(), {}, (e, r) -&gt; throw e if e?

	_toMagisterStyle: -&gt;
		obj = {}

		obj.Naam = @_name
		obj.OngelezenBerichten = @_unreadMessagesCount
		obj.Id = @_id
		obj.ParentId = @_parentId

		return obj

	@_convertRaw: (magisterObj, raw) -&gt;
		obj = new root.MessageFolder magisterObj

		obj._name = raw.Naam
		obj._unreadMessagesCount = raw.OngelezenBerichten
		obj._id = raw.Id
		obj._parentId = raw.ParentId

		return obj

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
