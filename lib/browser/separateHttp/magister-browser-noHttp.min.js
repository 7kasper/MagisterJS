/* Magister.js (browser version) by simplyApps. Built on: 13-06-2015 18:42 UTC */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=function(a,b){return function(){return a.apply(b,arguments)}};if(c=null!=(e="undefined"!=typeof module&&null!==module?module.exports:void 0)?e:null!=this.Magister?this.Magister:this.Magister={},c.Appointment=function(){function a(a){this._magisterObj=a,this.id=c._getset("_id"),this.begin=c._getset("_begin"),this.end=c._getset("_end"),this.beginBySchoolHour=c._getset("_beginBySchoolHour"),this.endBySchoolHour=c._getset("_endBySchoolHour"),this.fullDay=c._getset("_fullDay"),this.description=c._getset("_description"),this.location=c._getset("_location"),this.status=c._getset("_status"),this.type=c._getset("_type"),this.displayType=c._getset("_displayType"),this.content=c._getset("_content",null,function(a){return null!=a?a.replace(/<br ?\/?>/g,"\n").replace(/(<[^>]*>)|(&nbsp;)/g,"").replace(/\n{2,}/g,"\n").replace(/&amp;/gi,"&").trim():""}),this.infoType=c._getset("_infoType"),this.infoTypeString=c._getset("_infoType",null,function(a){switch(a){case 0:return"none";case 1:return"homework";case 2:return"test";case 3:return"exam";case 4:return"quiz";case 5:return"oral test";case 6:return"information";default:return"unknown"}}),this.notes=c._getset("_notes"),this.isDone=c._getset("_isDone",function(a){return function(b){return a._isDone!==b?(a._isDone=b,a._magisterObj.http.put(a.url(),a._toMagisterStyle(),{},function(){})):void 0}}(this)),this.classes=c._getset("_classes"),this.teachers=c._getset("_teachers"),this.classRooms=c._getset("_classRooms"),this.groups=c._getset("_groups"),this.appointmentId=c._getset("_appointmentId"),this.attachments=c._getset("_attachments"),this.url=c._getset("_url"),this.scrapped=c._getset("_scrapped"),this.absenceInfo=c._getset("_absenceInfo")}return a.prototype._toMagisterStyle=function(){var a,b,d,e;return b={},b.Id=this._id,b.Start=c._helpers.toUtcString(this._begin),b.Einde=c._helpers.toUtcString(this._end),b.LesuurVan=this._beginBySchoolHour,b.LesuurTotMet=this._endBySchoolHour,b.DuurtHeleDag=this._fullDay,b.Omschrijving=this._description,b.Lokatie=this._location,b.Status=this._status,b.Type=this._type,b.WeergaveType=this._displayType,b.Inhoud=this._content,b.InfoType=this._infoType,b.Aantekening=this._notes,b.Afgerond=this._isDone,b.Lokalen=function(){var b,c,d,e;for(d=this._classRooms,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push({Naam:a});return e}.call(this),b.Docenten=function(){var a,b,c,e;for(c=this._teachers,e=[],a=0,b=c.length;b>a;a++)d=c[a],e.push(d._toMagisterStyle());return e}.call(this),b.Vakken=function(){var b,c,d,e;for(d=this._classes,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push({Naam:a});return e}.call(this),b.Groepen=this._groups,b.OpdrachtId=this._appointmentId,b.Bijlagen=null!=(e=this._attachments)?e:[],b},a.prototype._makeStorable=function(){return d.omit(this,"_magisterObj")},a._convertRaw=function(a,b){var d,e,f,g,h;return e=new c.Appointment(a),e._id=b.Id,e._begin=new Date(Date.parse(b.Start)),e._end=new Date(Date.parse(b.Einde)),e._beginBySchoolHour=b.LesuurVan,e._endBySchoolHour=b.LesuurTotMet,e._fullDay=b.DuurtHeleDag,e._description=null!=(g=b.Omschrijving)?g:"",e._location=null!=(h=b.Lokatie)?h:"",e._status=b.Status,e._type=b.Type,e._displayType=b.WeergaveType,e._content=b.Inhoud,e._infoType=b.InfoType,e._notes=b.Aantekening,e._isDone=b.Afgerond,e._classes=null!=b.Vakken?function(){var a,c,e,f;for(e=b.Vakken,f=[],a=0,c=e.length;c>a;a++)d=e[a],f.push(d.Naam);return f}():[],e._teachers=null!=b.Docenten?function(){var d,e,g,h;for(g=b.Docenten,h=[],d=0,e=g.length;e>d;d++)f=g[d],h.push(c.Person._convertRaw(a,f));return h}():[],e._classRooms=null!=b.Lokalen?function(){var a,c,e,f;for(e=b.Lokalen,f=[],a=0,c=e.length;c>a;a++)d=e[a],f.push(d.Naam);return f}():[],e._groups=b.Groepen,e._appointmentId=b.OpdrachtId,e._attachments=b.Bijlagen,e._url=""+a._personUrl+"/afspraken/"+e._id,e._scrapped=0===b.Status,e},a._convertStored=function(a,b){var e;return e=d.extend(b,new c.Appointment(a)),e._magisterObj=a,e._begin=new Date(Date.parse(b._begin)),e._end=new Date(Date.parse(b._end)),e},a}(),c=null!=(f="undefined"!=typeof module&&null!==module?module.exports:void 0)?f:null!=this.Magister?this.Magister:this.Magister={},c.Assignment=function(){function a(a){this._magisterObj=a,this.id=c._getset("_id"),this.name=c._getset("_name"),this.description=c._getset("_description"),this["class"]=c._getset("_class"),this.deadline=c._getset("_deadline"),this.handedInOn=c._getset("_handedInOn"),this.files=c._getset("_files"),this.teachers=c._getset("_teachers"),this.grade=c._getset("_grade"),this.markedOn=c._getset("_markedOn"),this.handInAgain=c._getset("_handInAgain"),this.finished=c._getset("_finished"),this.canHandIn=c._getset("_canHandIn")}return a.prototype.versions=function(a){var b,d,e,f,g,h;for(d=c._helpers.asyncResultWaiter(this._versionIds.length,function(b){return a(null,b)}),g=this._versionIds,h=[],e=0,f=g.length;f>e;e++)b=g[e],h.push(this._magisterObj.http.get(""+this._magisterObj._personUrl+"/opdrachten/versie/"+b,{},function(b){return function(e,f){return null!=e?a(e,null):d(c.AssignmentVersion._convertRaw(b._magisterObj,b,JSON.parse(f.content)))}}(this)));return h},a._convertRaw=function(a,b){var d,e,f,g;return e=new c.Assignment(a),e._id=b.Id,e._name=b.Titel,e._description=b.Omschrijving,e._class=b.Vak,e._deadline=new Date(Date.parse(b.InleverenVoor)),e._handedInOn=new Date(Date.parse(b.IngeleverdOp)),e._files=function(){var e,f,g,h;for(g=b.Bijlagen,h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(c.File._convertRaw(a,void 0,d));return h}(),e._teachers=null!=b.Docenten?function(){var d,e,g,h;for(g=b.Docenten,h=[],d=0,e=g.length;e>d;d++)f=g[d],h.push(c.Person._convertRaw(a,f));return h}():void 0,e._versionIds=function(){var a,c,d,e;for(d=b.VersieNavigatieItems,e=[],a=0,c=d.length;c>a;a++)g=d[a],e.push(g.Id);return e}(),e._grade=b.Beoordeling,e._markedOn=new Date(Date.parse(b.BeoordeeldOp)),e._handInAgain=b.OpnieuwInleveren,e._finished=b.Afgesloten,e._canHandIn=b.MagInleveren,e},a}(),c.AssignmentVersion=function(){function a(a){this._magisterObj=a,this.id=c._getset("_id"),this["class"]=c._getset("_class"),this.state=c._getset("_state"),this.pupilMessage=c._getset("_pupilMessage"),this.teacherNotice=c._getset("_teacherNotice"),this.handedInFiles=c._getset("_handedInFiles"),this.feedbackFiles=c._getset("_feedbackFiles"),this.deadline=c._getset("_deadline"),this.handedInOn=c._getset("_handedInOn"),this.grade=c._getset("_grade"),this.markedOn=c._getset("_markedOn"),this.version=c._getset("_version"),this.tooLate=c._getset("_tooLate")}return a._convertRaw=function(a,b,d){var e,f;return f=new c.AssignmentVersion(a),f._id=d.Id,f._class=b._class,f._state=d.Status,f._pupilMessage=d.LeerlingOpmerking,f._teacherNotice=d.DocentOpmerking,f._handedInFiles=function(){var b,f,g,h;for(g=d.LeerlingBijlagen,h=[],b=0,f=g.length;f>b;b++)e=g[b],h.push(c.File._convertRaw(a,void 0,e));return h}(),f._feedbackFiles=function(){var b,f,g,h;for(g=d.FeedbackBijlagen,h=[],b=0,f=g.length;f>b;b++)e=g[b],h.push(c.File._convertRaw(a,void 0,e));return h}(),f._deadline=new Date(Date.parse(d.InleverenVoor)),f._handedInOn=new Date(Date.parse(d.IngeleverdOp)),f._grade=d.Beoordeling,f._markedOn=new Date(Date.parse(d.BeoordeeldOp)),f._version=d.VersieNummer,f._tooLate=d.IsTeLaat,f},a}(),c=null!=(k="undefined"!=typeof module&&null!==module?module.exports:void 0)?k:null!=this.Magister?this.Magister:this.Magister={},c.Class=function(){function a(a){this._magisterObj=a,this.id=c._getset("_id"),this.beginDate=c._getset("_beginDate"),this.endDate=c._getset("_endDate"),this.abbreviation=c._getset("_abbreviation"),this.description=c._getset("_description"),this.number=c._getset("_number"),this.teacher=c._getset("_teacher"),this.classExemption=c._getset("_classExemption")}return a._convertRaw=function(a,b){var d,e,f,g,h;return d=new c.Class(a),d._id=null!=(e=b.id)?e:b.Id,d._beginDate=new Date(Date.parse(b.begindatum)),d._endDate=new Date(Date.parse(b.einddatum)),d._abbreviation=null!=(f=b.afkorting)?f:b.Afkorting,d._description=null!=(g=b.omschrijving)?g:b.Omschrijving,d._number=null!=(h=b.volgnr)?h:b.Volgnr,d._teacher=c.Person._convertRaw(a,{Docentcode:b.docent}),d._classExemption=b.VakDispensatie||b.VakVrijstelling,d},a}(),c.Course=function(){function a(a){this._magisterObj=a,this.getOtherTutors=s(this.getOtherTutors,this),this.id=c._getset("_id"),this.begin=c._getset("_begin"),this.end=c._getset("_end"),this.schoolPeriod=c._getset("_schoolPeriod"),this.type=c._getset("_type"),this.group=c._getset("_group"),this.profile=c._getset("_profile"),this.alternativeProfile=c._getset("_alternativeProfile"),this.current=c._getset("_current")}return a.prototype.classes=function(a){return this._magisterObj.http.get(this._classesUrl,{},function(b){return function(d,e){var f;return null!=d?a(d,null):a(null,function(){var a,b,d,g;for(d=JSON.parse(e.content),g=[],a=0,b=d.length;b>a;a++)f=d[a],g.push(c.Class._convertRaw(this._magisterObj,f));return g}.call(b))}}(this))},a.prototype.grades=function(){var a,b,e,f,g;if(g=d.filter(arguments,function(a){return d.isBoolean(a)}),e=g[0],b=g[1],f=g[2],a=d.find(arguments,function(a){return d.isFunction(a)}),null==a)throw new Error("Callback can't be null");return null==e&&(e=!0),null==b&&(b=!0),null==f&&(f=!1),this._magisterObj.http.get(f?this._gradesUrlPrefix:this._gradesUrl,{},function(g){return function(h,i){var j,k,l,m,n;if(null!=h)return a(h,null);for(i=JSON.parse(i.content).Items,j=c._helpers.asyncResultWaiter(i.length,function(b){return d(b).uniq(function(a){return a["class"]().id}).pluck("_class").forEach(function(a){var c,e,f,g,h;for(g=d.filter(b,function(b){return b["class"]().id===a.id}),h=[],e=0,f=g.length;f>e;e++)c=g[e],h.push(c._class=a);return h}),a(null,d.sortBy(b,function(a){return a.dateFilledIn()}))}),n=[],l=0,m=i.length;m>l;l++)k=i[l],n.push(function(d){var h,i,k;return h=c.Grade._convertRaw(g._magisterObj,d),h._columnUrl=g._columnUrlPrefix+(null!=(k=d.CijferKolom)?k.Id:void 0),i=c._helpers.asyncResultWaiter(2,function(){return j(h)}),e&&!f?g._magisterObj.getPersons(h.Docent,3,function(a,b){return null==a&&null!=b[0]&&(h._teacher=b[0]),i()}):i(),b&&!f?h.fillGrade(function(b,c){return null!=b?a(b,null):i()}):i()}(k));return n}}(this))},a.prototype.getPersonalTutor=function(a){if(null==a)throw new Error("Callback can't be null");return this._magisterObj.http.get(""+this._magisterObj._personUrl+"/aanmeldingen/"+this._id+"/mentor",{},function(b){return function(d,e){return null!=d?a(d,null):a(null,c.Person._convertRaw(b._magisterObj,JSON.parse(e.content)))}}(this))},a.prototype.getOtherTutors=function(a){if(null==a)throw new Error("Callback can't be null");return this._magisterObj.http.get(""+this._magisterObj._personUrl+"/aanmeldingen/"+this._id+"/mentor",{},function(b){return function(d,e){var f,g;return null!=d?a(d,null):(f=JSON.parse(e.content).items,a(null,function(){var a,b,d;for(d=[],a=0,b=f.length;b>a;a++)g=f[a],d.push(c.Person._convertRaw(this._magisterObj,g));return d}.call(b)))}}(this))},a._convertRaw=function(a,b){var e,f;return e=new c.Course(a),e._classesUrl=a._personUrl+("/aanmeldingen/"+b.Id+"/vakken"),e._gradesUrlPrefix=a._personUrl+("/aanmeldingen/"+b.Id+"/cijfers"),e._gradesUrl=e._gradesUrlPrefix+"/cijferoverzichtvooraanmelding?actievePerioden=false&alleenBerekendeKolommen=false&alleenPTAKolommen=false",e._columnUrlPrefix=e._gradesUrlPrefix+"/extracijferkolominfo/",e._id=b.Id,e._begin=new Date(Date.parse(b.Start)),e._end=new Date(Date.parse(b.Einde)),e._schoolPeriod=b.Lesperiode,e._type={id:b.Studie.Id,description:b.Studie.Omschrijving},e._group={id:b.Groep.Id,description:b.Groep.Omschrijving,locationId:b.Groep.LocatieId},e._profile=b.Profiel,e._alternativeProfile=b.Profiel2,e._current=e._begin.getTime()<=(f=d.now())&&f<=e._end.getTime(),e},a}(),c=null!=(l="undefined"!=typeof module&&null!==module?module.exports:void 0)?l:null!=this.Magister?this.Magister:this.Magister={},c.DigitalSchoolUtility=function(){function a(a){this._magisterObj=a,this.id=c._getset("_id"),this.type=c._getset("_type"),this.name=c._getset("_name"),this.publisher=c._getset("_publisher"),this.state=c._getset("_state"),this.begin=c._getset("_begin"),this.end=c._getset("_end"),this.EAN=c._getset("_EAN"),this.url=c._getset("_url"),this["class"]=c._getset("_class")}return a._convertRaw=function(a,b){var d;return d=new c.DigitalSchoolUtility(a),d._id=b.Id,d._type=b.MateriaalType,d._name=b.Titel,d._publisher=b.Uitgeverij,d._state=b.Status,d._begin=new Date(Date.parse(b.Start)),d._end=new Date(Date.parse(b.Eind)),d._EAN=Number(b.EAN),d._url=b.Url,d._class=b.Vak,d},a}(),c=null!=(m="undefined"!=typeof module&&null!==module?module.exports:void 0)?m:null!=this.Magister?this.Magister:this.Magister={},c.FileFolder=function(){function a(a){this._magisterObj=a,this.id=c._getset("_id"),this.name=c._getset("_name"),this.rights=c._getset("_rights"),this.parentId=c._getset("_parentId")}return a.prototype.files=function(a){return this._magisterObj.http.get(""+this._magisterObj._personUrl+"/bronnen?parentId="+this.id(),{},function(b){return function(d,e){var f,g,h,i,j,k;if(null!=d)return a(d,null);for(g=function(){var a,b,d,g;for(d=JSON.parse(e.content).Items,g=[],a=0,b=d.length;b>a;a++)f=d[a],g.push(c.File._convertRaw(this._magisterObj,this,f));return g}.call(b),h=c._helpers.asyncResultWaiter(g.length,function(b){return a(null,g)}),k=[],i=0,j=g.length;j>i;i++)f=g[i],k.push(function(a){return b._magisterObj.getPersons(a.GeplaatstDoor,function(b,c){return null==b&&0!==c.length&&(a._addedBy=c[0]),h()})}(f));return k}}(this))},a._convertRaw=function(a,b){var d;return d=new c.FileFolder(a),d._id=b.Id,d._name=b.Naam,d._rights=b.Privilege,d._parentId=b.ParentId,d},a}(),c.File=function(){function a(a){this._magisterObj=a,this.id=c._getset("_id"),this.type=c._getset("_type"),this.name=c._getset("_name",function(a){return function(b){return a._name=b,a._update()}}(this)),this.uri=c._getset("_uri"),this.size=c._getset("_size"),this.rights=c._getset("_rights"),this.mime=c._getset("_mime"),this.changedDate=c._getset("_changedDate"),this.creationDate=c._getset("_creationDate"),this.addedBy=c._getset("_addedBy"),this.fileBlobId=c._getset("_fileBlobId"),this.fileFolder=c._getset("_fileFolder",this.move),this.uniqueId=c._getset("_uniqueId")}return a.prototype.download=function(){var a,b,c,e,f,g;if(b=null!=(g=d.find(arguments,function(a){return d.isString(a)||d.isBoolean(a)}))?g:!0,a=d.find(arguments,function(a){return d.isFunction(a)}),"undefined"!=typeof Meteor&&null!==Meteor?Meteor.isServer:void 0)f=Npm.require("request"),c=Npm.require("fs");else{if(null==("undefined"!=typeof module&&null!==module?module.exports:void 0))return void("function"==typeof a&&a(new Error("`File.download` is only accessible from the server at the moment.\nYou can set a proxy yourself with something like iron:router serverside routes."),null));f=require("request"),c=require("fs")}return b=d.isBoolean(b)&&b?this.name():d.isString(b)?/(\.{1,2}\/?)*$/.test(b)?b+="/"+this.name():b:void 0,e=f({url:this._downloadUrl,method:"GET",headers:this._magisterObj.http._cookieInserter(),encoding:null}).on("error",function(b){return"function"==typeof a?a(b,null):void 0}).on("response",function(b){return"function"==typeof a?a(null,""):void 0}),void(null!=b&&e.pipe(require("fs").createWriteStream(b)))},a.prototype.move=function(a){return this._magisterObj.fileFolders(function(b){return function(e,f){if(null!=e)throw e;return d.isObject(a)||(a=d.find(f,function(b){return c._helpers.contains(b.name(),a,!0)||b.id()===a})),b._fileFolder=a,b._update()}}(this))},a.prototype.remove=function(){return this._magisterObj.http["delete"](""+this._magisterObj._personUrl+"/bronnen/"+this.id(),{},function(a,b){if(null!=a)throw a})},a.prototype._update=function(){return this._magisterObj.http.put(""+this._magisterObj._personUrl+"/bronnen/"+this.id(),this._toMagisterStyle(),{},function(){})},a.prototype._toMagisterStyle=function(){var a;return a={},a.Id=this._id,a.BronSoort=this._type,a.Naam=this._name,a.Uri=this._uri,a.Grootte=this._size,a.Privilege=this._rights,a.ContentType=this._mime,a.FileBlobId=this._fileBlobId,a.ParentId=this._fileFolder.id(),a.UniqueId=this._uniqueId,a},a._convertRaw=function(a,b,e){var f,g,h,i;return null!=e._addedBy?f=e._addedBy:(f=new c.Person(a,null,"",""),f._fullName=e.GeplaatstDoor),h=new c.File(a),h._id=e.Id,h._type=e.BronSoort,h._name=e.Naam,h._uri=e.Uri,h._size=e.Grootte,h._rights=e.Privilege,h._mime=e.ContentType,h._changedDate=new Date(Date.parse(e.GewijzigdOp)),h._creationDate=new Date(Date.parse(null!=(i=e.GemaaktOp)?i:e.Datum)),h._addedBy=f,h._fileBlobId=e.FileBlobId,h._fileFolder=b,h._uniqueId=e.UniqueId,g=d.find(e.Links,{Rel:"Contents"}),null==g&&(g=d.find(e.Links,{Rel:"Self"})),h._downloadUrl=a.magisterSchool.url+g.Href,h},a}(),c=null!=(n="undefined"!=typeof module&&null!==module?module.exports:void 0)?n:null!=this.Magister?this.Magister:this.Magister={},c.Grade=function(){function a(a){this._magisterObj=a,this.id=c._getset("_id"),this.grade=c._getset("_grade"),this.passed=c._getset("_passed"),this.dateFilledIn=c._getset("_dateFilledIn"),this.gradePeriod=c._getset("_gradePeriod"),this["class"]=c._getset("_class"),this.atLaterDate=c._getset("_atLaterDate"),this.exemption=c._getset("_exemption"),this.counts=c._getset("_counts"),this.type=c._getset("_type"),this.teacher=c._getset("_teacher"),this.classExemption=c._getset("_classExemption"),this.description=c._getset("_description"),this.weight=c._getset("_weight")}return a.prototype.fillGrade=function(a){return this._filled?"function"==typeof a?a(null,this):void 0:this._magisterObj.http.get(this._columnUrl,{},function(b){return function(c,d){var e,f;return null!=c?"function"==typeof a?a(c,null):void 0:(d=JSON.parse(d.content),b._description=null!=(e=d.WerkInformatieOmschrijving)?e:"",b._weight=d.Weging,b._type._level=d.KolomNiveau,b._type._description=null!=(f=d.KolomOmschrijving)?f:"",b._filled=!0,"function"==typeof a?a(null,b):void 0)}}(this))},a._convertRaw=function(a,b){var d,e,f,g,h;return d=new c.Grade(a),d._id=b.CijferId,d._grade=b.CijferStr,d._passed=b.IsVoldoende,d._dateFilledIn=new Date(Date.parse(b.DatumIngevoerd)),d._gradePeriod={id:b.CijferPeriode.Id,name:null!=(f=b.CijferPeriode.Naam)?f:""},d._class={id:b.Vak.Id,abbreviation:null!=(g=b.Vak.Afkorting)?g:"",description:null!=(h=b.Vak.Omschrijving)?h:""},d._atLaterDate=b.Inhalen,d._exemption=b.Vrijstelling,d._counts=b.TeltMee,null!=(e=b.CijferKolom)&&(d._type=c.GradeType._convertRaw(a,e)),d._assignmentId=b.CijferKolomIdEloOpdracht,d._teacher=c.Person._convertRaw(a,{Docentcode:b.Docent}),d._teacher._type=3,d._classExemption=b.VakDispensatie||b.VakVrijstelling,d._description="",d._weight=0,d},a}(),c.GradeType=function(){function a(a){this._magisterObj=a,this.id=c._getset("_id"),this.name=c._getset("_name"),this.number=c._getset("_number"),this.header=c._getset("_header"),this.description=c._getset("_description"),this.type=c._getset("_type"),this.isAtLaterDate=c._getset("_isAtLaterDate"),this.isTeacher=c._getset("_isTeacher"),this.hasNestedTypes=c._getset("_hasNestedTypes"),this.isPTA=c._getset("_isPTA"),this.level=c._getset("_level"),this.isEnd=function(){return 2===this.type()}}return a._convertRaw=function(a,b){var d;return d=new c.GradeType(a),d._id=b.Id,d._name=b.KolomNaam,d._number=b.KolomNummer,d._header=b.KolomKop,d._type=b.KolomSoort,d._isAtLaterDate=b.IsHerkansingKolom,d._isTeacher=b.IsDocentKolom,d._hasNestedTypes=b.HeeftOndeliggendeKolommen,d._isPTA=b.IsPTAKolom,d._level=null,d._description="",d},a}(),c=null!=(o="undefined"!=typeof module&&null!==module?module.exports:void 0)?o:null!=this.Magister?this.Magister:this.Magister={},"undefined"!=typeof Meteor&&null!==Meteor)this._=d=lodash;else if(null==("undefined"!=typeof module&&null!==module?module.exports:void 0)||"undefined"==typeof require||null===require||"undefined"!=typeof window&&null!==window){if(null==this._)throw new Error("Lo-dash is required.");d=this["this"]}else null==d&&(this._=d=require("lodash"));c.VERSION="1.6.0",c.Magister=function(){function a(){var a,b,e,f,g;if(b={keepLoggedIn:!0},1===arguments.length&&d.isObject(arguments[0]))b=d.extend(b,arguments[0]);else{if(3!==arguments.length&&4!==arguments.length)throw new Error("Expected 3 or 4 arguments, got "+arguments.length);f=arguments[0],g=arguments[1],e=arguments[2],a=arguments[3],b=d.extend(b,{school:f,username:g,password:e,keepLoggedIn:a})}this._readyCallbacks=[],this.http=new c.MagisterHttp,this.magisterSchool=b.school,this.username=b.username,this.password=b.password,this._keepLoggedIn=b.keepLoggedIn,d.isString(this.magisterSchool)?c.MagisterSchool.getSchools(this.magisterSchool,function(a){return function(c,d){return null!=c?a._setErrored(c):0===d.length?a._setErrored(new Error("No school with the query "+a.magisterSchool+" found.")):(a.magisterSchool=d[0],a.reLogin(b.sessionId))}}(this)):this.reLogin(b.sessionId)}return a.prototype.appointments=function(){var a,b,e,f,g,h,i,j;return a=d.find(arguments,function(a){return d.isFunction(a)}),e=null!=(i=d.find(arguments,function(a){return d.isBoolean(a)}))?i:!1,j=d.where(arguments,function(a){return d.isDate(a)}),f=j[0],g=j[1],d.isDate(g)||(g=f),f=c._helpers.date(f),g=c._helpers.date(g),this._forceReady(),b=c._helpers.urlDateConvert,h=""+this._personUrl+"/afspraken?tot="+b(g)+"&van="+b(f),this.http.get(h,{},function(h){return function(i,j){var k,l,m,n,o,p,q,r,s;if(null!=i)return a(i,null);if(j=JSON.parse(j.content),m=function(){var a,b,d,e;for(d=j.Items,e=[],a=0,b=d.length;b>a;a++)k=d[a],e.push(c.Appointment._convertRaw(this,k));return e}.call(h),l=[],n=[],o=c._helpers.asyncResultWaiter(3,function(b){return d.each(m,function(a){return a._absenceInfo=d.find(l,function(b){return b.appointmentId===a.id()})}),m=d(m).reject(function(a){return d.contains(n,function(b){return b.id()===a.id()})}).concat(n).filter(function(a){return c._helpers.date(a.begin())<=g&&c._helpers.date(a.end())>=f}).sortBy("_begin").value(),a(null,m)}),h.http.get(""+h._personUrl+"/roosterwijzigingen?tot="+b(g)+"&van="+b(f),{},function(a,b){return b=JSON.parse(b.content),n.concat(function(){var a,d,e,f;for(e=b.Items,f=[],a=0,d=e.length;d>a;a++)k=e[a],f.push(c.Appointment._convertRaw(this,k));return f}.call(h)),o()}),h.http.get(""+h._personUrl+"/absenties?tot="+b(g)+"&van="+b(f),{},function(a,b){var d,e;for(b=JSON.parse(b.content).Items,d=0,e=b.length;e>d;d++)k=b[d],l.push({id:k.Id,begin:new Date(Date.parse(k.Start)),end:new Date(Date.parse(k.Eind)),schoolHour:k.Lesuur,permitted:k.Geoorloofd,appointmentId:k.AfspraakId,description:c._helpers.trim(k.Omschrijving),type:k.VerantwoordingType,code:k.Code});return o()}),e){for(p=c._helpers.asyncResultWaiter(m.length,function(){return o()}),s=[],q=0,r=m.length;r>q;q++)k=m[q],s.push(function(a){var b,c;return b=null!=(c=a.teachers())?c:[],h.fillPersons(b,function(b,c){return a._teachers=c,p()},3)}(k));return s}return o()}}(this))},a.prototype.messageFolders=function(a,b){var e;return null==b&&(b=function(){}),this._forceReady(),e=d.isString(a)&&""!==a?d.where(this._messageFolders,function(b){return c._helpers.contains(b.name(),a,!0)}):this._messageFolders,b(null,e),e},a.prototype.inbox=function(a){return null==a&&(a=function(){}),this.messageFolders("postvak in",function(b,c){return a(null,c[0])})[0]},a.prototype.sentItems=function(a){return null==a&&(a=function(){}),this.messageFolders("verzonden items",function(b,c){return a(null,c[0])})[0]},a.prototype.bin=function(a){return null==a&&(a=function(){}),this.messageFolders("verwijderde items",function(b,c){return a(null,c[0])})[0]},a.prototype.alerts=function(a){return null==a&&(a=function(){}),this.messageFolders("mededelingen",function(b,c){return a(null,c[0])})[0]},a.prototype.courses=function(a){var b;return this._forceReady(),b=""+this._personUrl+"/aanmeldingen",this.http.get(b,{},function(b){return function(e,f){var g,h;return null!=e?a(e,null):(f=JSON.parse(f.content),h=function(){var a,b,d,e;for(d=f.Items,e=[],a=0,b=d.length;b>a;a++)g=d[a],e.push(c.Course._convertRaw(this,g));return e}.call(b),a(null,d(h).sortBy("_beginDate").sortBy(function(a){return!a._current}).value()))}}(this))},a.prototype.currentCourse=function(a){return this._forceReady(),this.courses(function(b,c){return null!=b?a(b,null):a(null,d.find(c,function(a){return a.current()}))})},a.prototype.getLimitedCurrentCourseInfo=function(a){var b;return this._forceReady(),b=""+this._personUrl+"/opleidinggegevensprofiel",this.http.get(b,{},function(b,c){var d;return null!=b?a(b,null):(d=JSON.parse(c.content),a(null,{group:d.Klas,profile:d.Profielen,pupilId:d.StamNr,type:{year:+/\d+/.exec(d.Studie)[0],schoolVariant:/[^\d\s]+/.exec(d.Studie)[0]}}))})},a._cachedPersons={},a.prototype.getPersons=function(){var b,d,e,f,g;return this._forceReady(),d=c._helpers.trim(arguments[0]),b=2===arguments.length?arguments[1]:arguments[2],3===arguments.length&&(e=arguments[1]),null!=d&&null!=b&&d.length>=3?null==e?void this.getPersons(d,3,function(a){return function(e,f){var g;return null!=e?b(e,null):(g=f,a.getPersons(d,4,function(a,d){return null!=a?b(a,null):b(null,c._helpers.pushMore(d,g))}))}}(this)):(e=function(){switch(c.Person._convertType(e)){case 3:return"Personeel";case 4:return"Leerling";case 8:return"Project";default:return"Overig"}}(),f=""+this._personUrl+"/contactpersonen?contactPersoonType="+e+"&q="+d.replace(/\ +/g,"+"),null!=(g=a._cachedPersons[""+this._id+e+d])?b(null,g):this.http.get(f,{},function(f){return function(g,h){var i;return null!=g?b(g,null):(h=function(){var a,b,d,e;for(d=JSON.parse(h.content).Items,e=[],a=0,b=d.length;b>a;a++)i=d[a],e.push(c.Person._convertRaw(this,i));return e}.call(f),a._cachedPersons[""+f._id+e+d]=h,b(null,h))}}(this))):void b(null,[])},a.prototype.fillPersons=function(a,b,e){var f,g,h,i,j,k;if(this._forceReady(),d.isArray(a)){if(0===a.length)return void b(null,[]);for(g=c._helpers.asyncResultWaiter(a.length,function(a){return b(null,a)}),h=0,i=a.length;i>h;h++){f=a[h];try{this.getPersons(d.last(f.fullName().split(" ")),null!=(j=f._type)?j:e,function(a,b){var c;if(null!=a||null==b)throw a;return g(null!=(c=b[0])?c:f)})}catch(l){g(f)}}}else{if(!d.isObject(a))throw new Error("Expected persons to be an Array or an Object, got a(n) "+typeof a);try{this.getPersons(d.last(a.fullName().split(" ")),null!=(k=a._type)?k:e,function(c,d){var e;if(null!=c||null==d)throw c;return b(null,null!=(e=d[0])?e:a)})}catch(l){b(a)}}return void 0},a.prototype.composeAndSendMessage=function(){var a,b,e,f,g,h;return this._forceReady(),h=d.filter(arguments,function(a){return d.isString(a)}),g=h[0],a=h[1],b=d.find(arguments,function(a){return d.isFunction(a)}),f=d.findLast(arguments,function(a){return a!==b}),2===arguments.length&&(a=""),e=new c.Message(this),e.subject(g),e.body(null!=a?a:""),e.addRecipient(f),e.send(b)},a.prototype.fileFolders=function(a){return this._forceReady(),this.http.get(""+this._personUrl+"/bronnen?soort=0",{},function(b){return function(d,e){var f;return null!=d?a(d,null):a(null,function(){var a,b,d,g;for(d=JSON.parse(e.content).Items,g=[],a=0,b=d.length;b>a;a++)f=d[a],g.push(c.FileFolder._convertRaw(this,f));return g}.call(b))}}(this))},a.prototype.studyGuides=function(a){var b,e,f;return this._forceReady(),e=null!=(f=d.find(arguments,function(a){return d.isBoolean(a)}))?f:!0,a=d.find(arguments,function(a){return d.isFunction(a)}),b=function(b){return function(e){return b.http.get(""+b._pupilUrl+"/studiewijzers?peildatum="+c._helpers.urlDateConvert(new Date),{},function(f,g){var h,i,j,k,l;if(null!=f)return a(f,null);for(g=function(){var a,b,d,e;for(d=JSON.parse(g.content).Items,e=[],a=0,b=d.length;b>a;a++)h=d[a],e.push(c.StudyGuide._convertRaw(this,h));return e}.call(b),j=function(a){return null!=e?a._class=d.find(e,function(b){return b.abbreviation()===a._class}):a._class=null},k=0,l=g.length;l>k;k++)i=g[k],j(i);return a(null,g)})}}(this),e?this.courses(function(a,c){return null!=c&&0!==c.length?c[0].classes(function(a,c){return null!=c&&0!==c.length?b(c):b()}):b()}):b()},a.prototype.assignments=function(){var a,b,e,f,g,h,i,j;return this._forceReady(),i=d.filter(arguments,function(a){return d.isNumber(a)}),a=i[0],h=i[1],j=d.filter(arguments,function(a){return d.isBoolean(a)}),g=j[0],f=j[1],b=d.find(arguments,function(a){return d.isFunction(a)}),null!=b?(null==g&&(g=!1),null==f&&(f=!0),null==a&&(a=50),null==h&&(h=0),e=function(e){return function(f){return e.http.get(""+e._personUrl+"/opdrachten?skip="+h+"&top="+a+"&status=alle",{},function(a,h){var i,j,k,l,m,n;if(null!=a)return b(a,null);for(h=function(){var a,b,c,d;for(c=JSON.parse(h.content).Items,d=[],a=0,b=c.length;b>a;a++)i=c[a],d.push(i.Id);return d}(),k=c._helpers.asyncResultWaiter(h.length,function(a){return b(null,a)}),n=[],l=0,m=h.length;m>l;l++)j=h[l],n.push(e.http.get(""+e._personUrl+"/opdrachten/"+j,{},function(a,b){var h,i,j;return h=c.Assignment._convertRaw(e,JSON.parse(b.content)),null!=f?h._class=d.find(f,function(a){return a.abbreviation()===h._class}):h._class=null,g?(i=null!=(j=h.teachers())?j:[],e.fillPersons(i,function(a,b){return h._teachers=b,k(h)},3)):k(h)}));return n})}}(this),f?this.courses(function(a,b){return null!=b&&0!==b.length?b[0].classes(function(a,b){return null!=b&&0!==b.length?e(b):e()}):e()}):e()):void 0},a.prototype.digitalSchoolUtilities=function(){var a,b,e,f,g,h;return this._forceReady(),e=null!=(h=d.find(arguments,function(a){return d.isBoolean(a)}))?h:!0,a=d.find(arguments,function(a){return d.isFunction(a)}),null!=a?(d.isObject(g)&&(g=g.id()),f=null!=g?""+this._personUrl+"/lesmateriaal?vakken="+g:""+this._personUrl+"/lesmateriaal",b=function(b){return function(e){return b.http.get(f,{},function(f,g){var h,i,j,k,l,m,n,o;if(null!=f)return a(f,null);if(i=function(){var a,b,d,e;for(d=JSON.parse(g.content).Items,e=[],a=0,b=d.length;b>a;a++)h=d[a],e.push(c.DigitalSchoolUtility._convertRaw(this,h));return e}.call(b),null!=e)for(j=function(a){return a._class=d.find(e,function(b){return b.abbreviation()===a._class.Afkorting&&b.description()===a._class.Omschrijving})},l=0,n=i.length;n>l;l++)h=i[l],j(h);else for(k=function(a){return a._class=c.Class._convertRaw(b,a._class)},m=0,o=i.length;o>m;m++)h=i[m],k(h);return a(null,i)})}}(this),e?this.courses(function(a,c){return null!=c&&0!==c.length?d.last(c).classes(function(a,c){return b(c)}):void 0}):b()):void 0},a.prototype.profileInfo=function(a){return this._forceReady(),"function"==typeof a&&a(null,this._profileInfo),this._profileInfo},a.prototype.children=function(a){return this.http.get(""+this._personUrl+"/kinderen",{},function(b){return function(e,f){var g,h,i,j,k,l,m;if(null!=e)return a(e,null);if(h=JSON.parse(f.content),null!=h.ExceptionId&&1===h.Reason)return void a(d.extend(h,{message:"User is not a parent."}),null);for(j=[],m=h.Items,k=0,l=m.length;l>k;k++)i=m[k],g=c.ProfileInfo._convertRaw(b,g),g._profilePicture=""+b.magisterSchool.url+"/api/personen/"+i.Id+"/foto",g.magister(function(a){var e;return e=d.clone(b),e._id=i.Id,e._personUrl=""+b.magisterSchool.url+"/api/personen/"+e._id,e._pupilUrl=""+b.magisterSchool.url+"/api/leerlingen/"+e._id,e._profileInfo=g,void b.http.get(""+e._personUrl+"/berichten/mappen",{},function(b,d){var f;return e._messageFolders=function(){var a,b,g,h;for(g=JSON.parse(d.content).Items,h=[],a=0,b=g.length;b>a;a++)f=g[a],h.push(c.MessageFolder._convertRaw(e,f));return h}(),a(e)})}),j.push(g);return a(null,j)}}(this))},a.prototype.ready=function(a){return d.isFunction(a)&&(this._ready||null!=this._magisterLoadError?d.bind(a,this)(this._magisterLoadError):this._readyCallbacks.push(d.bind(a,this))),this._ready===!0},a.prototype._forceReady=function(){if(!this._ready)throw new Error("Not done with logging in or errored during logging in! (did you use Magister.ready(callback) to be sure that logging in is done?)")},a.prototype._setReady=function(){var a,b,c,d;for(this._ready=!0,d=this._readyCallbacks,b=0,c=d.length;c>b;b++)(a=d[b])();return this._readyCallbacks=[]},a.prototype._setErrored=function(a){var b,c,d,e,f,g;try{d=JSON.parse(a),this._magisterLoadError={};for(c in d)this._magisterLoadError[c.toLowerCase()]=d[c];

}catch(h){this._magisterLoadError=a}for(g=this._readyCallbacks,e=0,f=g.length;f>e;e++)(b=g[e])(this._magisterLoadError);return this._readyCallbacks=[]},a.prototype._readyCallbacks=[],a.prototype._magisterLoadError=null,a.prototype.reLogin=function(a){var b,d;return this._ready=!1,this._magisterLoadError=null,this.magisterSchool.url=this.magisterSchool.url.replace(/^https?/,"https"),d=""+this.magisterSchool.url+"/api/sessie",b=function(a){return function(b){var d;try{return a._sessionId=b,a.http._cookie="SESSION_ID="+a._sessionId+"; M6UserName="+a.username,a.http.get(""+a.magisterSchool.url+"/api/account",{},function(b,d){var e;if(null!=b)return void a._setErrored(b);try{d=JSON.parse(d.content),a._group=d.Groep[0],a._id=d.Persoon.Id,a._personUrl=""+a.magisterSchool.url+"/api/personen/"+a._id,a._pupilUrl=""+a.magisterSchool.url+"/api/leerlingen/"+a._id,a._profileInfo=c.ProfileInfo._convertRaw(a,d)}catch(f){e=f,_setErrored(e)}return a.http.get(""+a._personUrl+"/berichten/mappen",{},function(b,d){var e;return null!=b?void a._setErrored(b):(a._messageFolders=function(){var a,b,f,g;for(f=JSON.parse(d.content).Items,g=[],a=0,b=f.length;b>a;a++)e=f[a],g.push(c.MessageFolder._convertRaw(this,e));return g}.call(a),a._setReady())})})}catch(e){return d=e,_setErrored(d)}}}(this),null!=a?b(a):this.http.post(d,{Gebruikersnaam:this.username,Wachtwoord:this.password,GebruikersnaamOnthouden:!0,IngelogdBlijven:this._keepLoggedIn},{headers:{"Content-Type":"application/json;charset=UTF-8"}},function(a){return function(c,d){return null!=c?a._setErrored(c):null!=d.content?a._setErrored(d.content):b(/[a-z\d-]+/.exec(d.headers["set-cookie"][0])[0])}}(this))},a}(),c=null!=(p="undefined"!=typeof module&&null!==module?module.exports:void 0)?p:null!=this.Magister?this.Magister:this.Magister={},b=function(a,b){switch(b){case 1:return a.inbox();case 2:return a.sentItems();case 3:return a.bin();case 4:return a.alerts();default:return c.MessageFolder._convertRaw({Id:b})}},c.Message=function(){function a(a){if(this._magisterObj=a,null==this._magisterObj)throw new Error("Magister instance is null!");this._magisterObj._forceReady(),this._canSend=!0,this._sender=this._magisterObj.profileInfo(),this._recipients=[],this._sendDate=new Date,this._isRead=!1,this._type=1,this._subject="",this._body="",this.id=c._getset("_id"),this.body=c._getset("_body",function(a){return function(b){return a._body=(null!=b?b:"").replace("\n","<br>")}}(this),function(a){return null!=a?a.replace(/<br ?\/?>/g,"\n").replace(/(<[^>]*>)|(&nbsp;)/g,""):""}),this.attachments=c._getset("_attachments"),this.messageFolder=c._getset("_folderId",function(a){return function(b){return a.move(b)}}(this),function(a){return function(c){return b(a._magisterObj,c)}}(this)),this.subject=c._getset("_subject",function(a){return function(b){return a._subject=b}}(this)),this.sender=c._getset("_sender"),this.recipients=c._getset("_recipients"),this.sendDate=c._getset("_sendDate"),this.begin=c._getset("_begin"),this.end=c._getset("_end"),this.isRead=c._getset("_isRead",function(a){return function(b){return a._isRead===b||a._canSend?void 0:(a._isRead=b,a._update())}}(this)),this.state=c._getset("_state"),this.isFlagged=c._getset("_isFlagged"),this.type=c._getset("_type")}return a.prototype._tasks=0,a.prototype._sendAfterFinished=!1,a.prototype._finishedCallback=null,a.prototype._working=function(){return 0!==this._tasks},a.prototype._tickDown=function(){return 0===--this._tasks&&this._sendAfterFinished?this.send(this._finishedCallback):void 0},a.prototype._reset=function(){return this._tasks=0,this._sendAfterFinished=!1},a.prototype.addRecipient=function(a,b){var c,e,f;if(d.isString(a))this._tasks++,this._magisterObj.getPersons(a,b,function(c){return function(d,e){if(0!==e.length)return c.recipients().push(e[0]),c._tickDown();throw null!=b?(c._reset(),new Error("Couldn't find a person with the type: \""+b+'" and with the query: "'+a+'"')):(c._reset(),new Error("Couldn't find a person with the query: \""+a+'"'))}}(this));else if(d.isArray(a))for(e=0,f=a.length;f>e;e++)c=a[e],this.addRecipient(c,b);else{if(!d.isObject(a))throw this._reset(),new Error("Expected recipient to be a String or an Object, got a(n) "+typeof a);this.recipients().push(a)}return void 0},a.prototype.createReplyMessage=function(a){var b,d;return d=0!==this.subject().indexOf("RE: ")?"RE: "+this.subject():d(),b=new c.Message(this._magisterObj),b._sender=this._sender,b._folderId=this._folderId,b._isFlagged=this._isFlagged,b._id=this._id,b._body=(null!=a?""+a+"<br><br>---------------<br>":"")+("<b>Van:</b> "+this.sender().description()+"<br><b>Verzonden:</b> "+this.sendDate().toLocaleString()+"<br><b>Aan:</b> "+this.recipients().map(function(a){return a.fullName()}).join(", ")+"<br><b>Onderwerp:</b> "+this.subject()+'<br><br>"'+this.body()+'"<br><br>'),b._subject=d,b._recipients=[this.sender()],b},a.prototype.createReplyToAllMessage=function(a){var b,e;return e=0!==this.subject().indexOf("RE: ")?"RE: "+this.subject():e(),b=new c.Message(this._magisterObj),b._sender=this._sender,b._folderId=this._folderId,b._isFlagged=this._isFlagged,b._id=this._id,b._body=(null!=a?""+a+"<br><br>---------------<br>":"")+("<b>Van:</b> "+this.sender().description()+"<br><b>Verzonden:</b> "+this.sendDate().toLocaleString()+"<br><b>Aan:</b> "+this.recipients().map(function(a){return a.fullName()}).join(", ")+"<br><b>Onderwerp:</b> "+this.subject()+'<br><br>"'+this.body()+'"<br><br>'),b._subject=e,b._recipients=d.reject(this.recipients(),function(a){return a.id()===this._magisterObj.profileInfo().id()}).concat([this.sender()]),b},a.prototype.createForwardMessage=function(a){var b,d;return d=0!==this.subject().indexOf("FW: ")?"FW: "+this.subject():d(),b=new c.Message(this._magisterObj),b._sender=this._sender,b._folderId=this._folderId,b._isFlagged=this._isFlagged,b._id=this._id,b._body=(null!=a?""+a+"<br><br>---------------<br>":"")+("<b>Van:</b> "+this.sender().description()+"<br><b>Verzonden:</b> "+this.sendDate().toLocaleString()+"<br><b>Aan:</b> "+this.recipients().map(function(a){return a.fullName()}).join(", ")+"<br><b>Onderwerp:</b> "+this.subject()+'<br><br>"'+this.body()+'"<br><br>'),b._subject=d,b},a.prototype.send=function(a){if(this._working())return this._sendAfterFinished=!0,this._finishedCallback=a,!1;if(!this._canSend)throw new Error("This message is marked as unsendable");if(null==this.recipients()||null==this.sender())throw new Error("Sender and/or recipients cannot be null");if(d.isEmpty(this.subject()))throw new Error("Subject cannot be null or empty");return this._magisterObj.http.post(""+this._magisterObj._personUrl+"/berichten",this._toMagisterStyle(),{},function(b){return function(c,d){return null!=c?"function"==typeof a?a(c,null):void 0:"function"==typeof a?a(null,b):void 0}}(this)),!0},a.prototype.move=function(a){if(d.isObject(a)&&(a=a.id()),!d.isNumber(a))throw new Error("Could not resolve MessageFolder form the given destination.");return this._folderId!==a?(this._folderId=a,this._update()):void 0},a.prototype.remove=function(a){return this._magisterObj.http["delete"](""+this._magisterObj._personUrl+"/berichten/"+this.id(),{},function(b,c){return"function"==typeof a?a(b):void 0})},a.prototype._update=function(){return this._magisterObj.http.put(""+this._magisterObj._personUrl+"/berichten/"+this.id()+"?berichtSoort="+this.type(),this._toMagisterStyle(),{},function(){})},a.prototype._toMagisterStyle=function(){var a,b;return a={},a.Id=this._id,a.Inhoud=this._body,a.MapId=this._folderId,a.Onderwerp=this._subject,a.Ontvangers=function(){var a,c,d,e;for(d=this._recipients,e=[],a=0,c=d.length;c>a;a++)b=d[a],e.push(b._toMagisterStyle());return e}.call(this),a.VerstuurdOp=this._sendDate,a.Begin=this._begin,a.Einde=this._end,a.IsGelezen=this._isRead,a.Status=this._state,a.HeeftPrioriteit=this._isFlagged,a.Soort=this._type,a},a._convertRaw=function(a,b){var d,e,f;return e=new c.Message(a),e._id=b.Id,e._body=null!=(f=b.Inhoud)?f:"",e._folderId=b.MapId,e._subject=b.Onderwerp,e._sender=c.Person._convertRaw(a,b.Afzender),e._recipients=function(){var e,f,g,h,i;for(g=null!=(h=b.Ontvangers)?h:[],i=[],e=0,f=g.length;f>e;e++)d=g[e],i.push(c.Person._convertRaw(a,d));return i}(),e._sendDate=new Date(Date.parse(b.VerstuurdOp)),e._begin=new Date(Date.parse(b.Begin)),e._end=new Date(Date.parse(b.Einde)),e._isRead=b.IsGelezen,e._state=b.Status,e._isFlagged=b.HeeftPrioriteit,e._type=b.Soort,e._canSend=!1,e},a}(),c=null!=(q="undefined"!=typeof module&&null!==module?module.exports:void 0)?q:null!=this.Magister?this.Magister:this.Magister={},a=function(a){var b,e,f;return b="",d.any(["unread","ongelezen"],function(b){return c._helpers.contains(a,b,!0)})?b+="&gelezen=false":d.any(["read","gelezen"],function(b){return c._helpers.contains(a,b,!0)})&&(b+="&gelezen=true"),null!=(f=/(skip \d+)|(sla \d+ over)/gi.exec(a))&&(e=/\d+/.exec(f[0])[0],b+="&skip="+e),b},c.MessageFolder=function(){function b(a){this._magisterObj=a,this.name=c._getset("_name"),this.unreadMessagesCount=c._getset("_unreadMessagesCount"),this.id=c._getset("_id"),this.parentId=c._getset("_parentId")}return b.prototype.messages=function(){var b,e,f,g,h,i,j,k;if(f=null!=(k=d.find(arguments,function(a){return d.isNumber(a)}))?k:10,g=null!=(i=d.find(arguments,function(a){return d.isString(a)}))?i:"",e=null!=(j=d.find(arguments,function(a){return d.isBoolean(a)}))?j:!1,b=d.find(arguments,function(a){return d.isFunction(a)}),null==b)throw new Error("Callback is null");return 0===f?void b(null,[]):(h=""+this._magisterObj._personUrl+"/berichten?mapId="+this.id()+"&top="+f+a(g),this._magisterObj.http.get(h,{},function(a){return function(f,g){var i,j,k,l,m,n;if(null!=f)b(f,null);else for(j=function(){var a,b,d,e;for(d=JSON.parse(g.content).Items,e=[],a=0,b=d.length;b>a;a++)i=d[a],e.push(c.Message._convertRaw(this._magisterObj,i));return e}.call(a),k=c._helpers.asyncResultWaiter(j.length,function(a){return b(null,d.sortBy(a,function(a){return a.sendDate()}).reverse())}),l=function(b){return h=""+a._magisterObj._personUrl+"/berichten/"+b.id()+"?berichtSoort="+b.type(),a._magisterObj.http.get(h,{},function(d,f){var g,h,i;return h=JSON.parse(f.content),b._body=h.Inhoud,b._attachments=function(){var a,b,d,e,f;for(e=null!=(d=h.Bijlagen)?d:[],f=[],a=0,b=e.length;b>a;a++)g=e[a],f.push(c.File._convertRaw(this._magisterObj,void 0,g));return f}.call(a),e?(i=c._helpers.asyncResultWaiter(b.recipients().length+1,function(){return k(b)}),a._magisterObj.fillPersons(b.recipients(),function(a,c){return b._recipients=c,i(c)}),a._magisterObj.fillPersons(b.sender(),function(a,c){return b._sender=c,i(c)})):k(b)})},m=0,n=j.length;n>m;m++)i=j[m],l(i);return void 0}}(this)))},b.prototype.messageFolders=function(a,b){var e;return b=null!=(e=null!=b?b:a)?e:function(){},null!=b?this._magisterObj.http.get(""+this._magisterObj._personUrl+"/berichten/mappen?parentId="+this.id(),{},function(e){return function(f,g){var h,i;return null!=f?b(f,null):(i=function(){var a,b,d,e;for(d=JSON.parse(g.content).Items,e=[],a=0,b=d.length;b>a;a++)h=d[a],e.push(c.MessageFolder._convertRaw(this._magisterObj,h));return e}.call(e),g=d.isString(a)&&""!==a?d.where(i,function(b){return Helpers.contains(b.name(),a,!0)}):i,b(null,g))}}(this)):void 0},b.prototype.removeAllMessages=function(){return this._magisterObj.http["delete"](""+this._magisterObj._personUrl+"/berichten/map/"+this.id(),{},function(a,b){if(null!=a)throw a})},b.prototype.createMessageFolder=function(a,b){var d;return null==b&&(b=function(){}),d={naam:a,parentId:this.id(),persoonId:this._magisterObj._id},this._magisterObj.http.post(""+this._magisterObj._personUrl+"/berichten/mappen",d,{},function(a){return function(d,e){return null!=d?b(d,null):b(null,c.MessageFolder._convertRaw(a._magisterObj,JSON.parse(e.content)))}}(this))},b.prototype.remove=function(){return this._magisterObj.http.put(""+this._magisterObj._personUrl+"/berichten/mappen",this._toMagisterStyle(),{},function(a,b){if(null!=a)throw a})},b.prototype._toMagisterStyle=function(){var a;return a={},a.Naam=this._name,a.OngelezenBerichten=this._unreadMessagesCount,a.Id=this._id,a.ParentId=this._parentId,a},b._convertRaw=function(a,b){var d;return d=new c.MessageFolder(a),d._name=b.Naam,d._unreadMessagesCount=b.OngelezenBerichten,d._id=b.Id,d._parentId=b.ParentId,d},b}(),c=null!=(r="undefined"!=typeof module&&null!==module?module.exports:void 0)?r:null!=this.Magister?this.Magister:this.Magister={},c.Person=function(){function a(b,e,f,g){if(this._magisterObj=b,this._type=e,this._firstName=f,this._lastName=g,null!=this._firstName&&null!=this._lastName&&d.any(d.toArray(arguments).slice(2),function(a){return null!=a&&!d.isString(a)}))throw new Error("One or more arguments is not a string.");this.id=c._getset("_id"),this.type=c._getset("_type",function(b){return function(c){return b._type=a._convertType(c,!0)}}(this),a._convertType),this.firstName=c._getset("_firstName"),this.lastName=c._getset("_lastName"),this.namePrefix=c._getset("_namePrefix"),this.fullName=c._getset("_fullName"),this.description=c._getset("_description"),this.group=c._getset("_group"),this.teacherCode=c._getset("_teacherCode"),this.emailAddress=c._getset("_emailAddress")}return a.prototype._toMagisterStyle=function(){var a;return a={},a.Id=this._id,a.Type=this._type,a.Voornaam=this._firstName,a.Achternaam=this._lastName,a.Tussenvoegsel=this._namePrefix,a.Naam=this._fullName,a.Omschrijving=this._description,a.Groep=this._group,a.Docentcode=this._teacherCode,a.Emailadres=this._emailAddress,a},a._convertRaw=function(a,b){var d,e,f;return d=new c.Person(a,b.Type,b.Voornaam,b.Achternaam),d._id=b.Id,d._namePrefix=b.Tussenvoegsel,d._fullName=b.Naam,d._description=null!=(e=null!=(f=b.Omschrijving)?f:b.Naam)?e:b.naam,d._group=b.Groep,d._teacherCode=b.Docentcode,d._emailAddress=b.Emailadres,d},a._convertType=function(a,b){if(null==b&&(b=!0),b){if(d.isNumber(a)){if(!d.contains([1,3,4,8],a))throw new Error('Invalid value: "'+a+'".');return a}switch(a.toLowerCase()){case"group":return 1;case"teacher":return 3;case"pupil":return 4;case"project":return 8;default:throw new Error('Invalid value: "'+a+'".')}}else switch(a){case 1:return"group";case 3:return"teacher";case 4:return"pupil";case 8:return"project";default:return void 0}},a}(),c=null!=(g="undefined"!=typeof module&&null!==module?module.exports:void 0)?g:null!=this.Magister?this.Magister:this.Magister={},c.ProfileInfo=function(){function a(a,b,d,e){this._magisterObj=a,this._firstName=b,this._lastName=d,this._birthDate=e,this.id=c._getset("_id"),this.officialFirstNames=c._getset("_officialFirstNames"),this.initials=c._getset("_initials"),this.namePrefix=c._getset("_namePrefix"),this.officialSurname=c._getset("_officialSurname"),this.birthSurname=c._getset("_birthSurname"),this.birthNamePrefix=c._getset("_birthNamePrefix"),this.useBirthname=c._getset("_useBirthname"),this.firstName=c._getset("_firstName"),this.lastName=c._getset("_lastName"),this.fullName=function(){return this.firstName()+" "+this.lastName()},this.birthDate=c._getset("_birthDate")}return a.prototype.profilePicture=function(a,b,c){return null==a&&(a=640),null==b&&(b=640),null==c&&(c=!1),""+this._magisterObj._personUrl+"/foto?width="+a+"&height="+b+"&crop="+c},a.prototype.detailedInfo=function(a){var b;if(null==a)throw new Error("`callback` is required.");return b=c._helpers.asyncResultWaiter(2,function(b){return a(null,c.DetailedProfileInfo._convertRaw(d.extend(b[0],b[1])))}),this._magisterObj.http.get(""+this._magisterObj._personUrl+"/profiel",{},function(c,d){return null!=c?a(c,null):b(JSON.parse(d.content))}),this._magisterObj.http.get(""+this._magisterObj._personUrl+"/adresprofiel",{},function(c,d){return null!=c?a(c,null):b(JSON.parse(d.content))})},a._convertRaw=function(a,b){var d;return b=b.Persoon,d=new c.ProfileInfo(a,b.Roepnaam,b.Achternaam,new Date(Date.parse(b.Geboortedatum))),d._id=b.Id,d._officialFirstNames=b.OfficieleVoornamen,d._initials=b.Voorletters,d._namePrefix=b.Tussenvoegsel,d._officialSurname=b.OfficieleAchternaam,d._birthSurname=b.GeboorteAchternaam,d._birthNamePrefix=b.GeboortenaamTussenvoegsel,d._useBirthname=b.GebruikGeboortenaam,d},a}(),c.DetailedProfileInfo=function(){function a(){this.redirectMagisterMessages=c._getset("_redirectMagisterMessages"),this.emailAddress=c._getset("_emailAddress"),this.mobileNumber=c._getset("_mobileNumber"),this.postalCode=c._getset("_postalCode"),this.street=c._getset("_street"),this.houseNumber=c._getset("_houseNumber"),this.suffix=c._getset("_suffix"),this.city=c._getset("_city")}return a._convertRaw=function(){var a,b;return b=arguments[2===arguments.length?1:0],a=new c.DetailedProfileInfo,a._redirectMagisterMessages=b.EloBerichtenDoorsturen,a._emailAddress=b.EmailAdres,a._mobileNumber=b.Mobiel,a._postalCode=b.Postcode,a._street=b.Straatnaam,a._houseNumber=b.Huisnummer,a._suffix=b.Toevoeging,a._city=b.Woonplaats,a},a}(),c=null!=(h="undefined"!=typeof module&&null!==module?module.exports:void 0)?h:null!=this.Magister?this.Magister:this.Magister={},c.MagisterSchool=function(){function a(a,b,c){this.id=a,this.name=b,this.url=c}return a.getSchools=function(a,b){return null==a||c._helpers.trim(a).length<3?void b(null,[]):(a=a.replace(/\d/g,"").trim(),(new c.MagisterHttp).get("https://mijn.magister.net/api/schools?filter="+a,{},function(a){return function(c,d){var e;return null!=c?b(c,null):b(null,function(){var a,b,c,f;for(c=JSON.parse(d.content),f=[],a=0,b=c.length;b>a;a++)e=c[a],f.push(this._convertRaw(e));return f}.call(a))}}(this)))},a._convertRaw=function(a){return new c.MagisterSchool(a.Id,a.Name,a.Url)},a}(),c=null!=(i="undefined"!=typeof module&&null!==module?module.exports:void 0)?i:null!=this.Magister?this.Magister:this.Magister={},c.StudyGuide=function(){function a(a){this._magisterObj=a,this.id=c._getset("_id"),this.from=c._getset("_from"),this.to=c._getset("_to"),this.classCodes=c._getset("_classCodes"),this.name=c._getset("_name"),this.archived=c._getset("_archived"),this["class"]=c._getset("_class")}return a.prototype.parts=function(a){return null!=a?this._magisterObj.http.get(""+this._magisterObj._pupilUrl+"/studiewijzers/"+this.id(),{},function(b){return function(d,e){var f,g,h,i,j,k,l;if(null!=d)return a(d,null);for(e=JSON.parse(e.content).Onderdelen.Items,h=c._helpers.asyncResultWaiter(e.length,function(b){return a(null,b)}),k=function(){var a,b,c;for(c=[],a=0,b=e.length;b>a;a++)g=e[a],c.push(g.Id);return c}(),l=[],i=0,j=k.length;j>i;i++)f=k[i],l.push(b._magisterObj.http.get(""+b._magisterObj._pupilUrl+"/studiewijzers/"+b.id()+"/onderdelen/"+f,{},function(a,d){return h(c.StudyGuidePart._convertRaw(b._magisterObj,JSON.parse(d.content)))}));return l}}(this)):void 0},a._convertRaw=function(a,b){var d;return d=new c.StudyGuide(a),d._id=b.Id,d._from=new Date(Date.parse(b.Van)),d._to=new Date(Date.parse(b.TotEnMet)),d._classCodes=b.VakCodes,d._class=b.VakCodes[0],d._name=b.Titel,d._archived=b.InLeerlingArchief,d},a}(),c.StudyGuidePart=function(){function a(a){this._magisterObj=a,this.id=c._getset("_id"),this.from=c._getset("_from"),this.to=c._getset("_to"),this.name=c._getset("_name"),this.description=c._getset("_description",null,function(a){return null!=a?a.replace(/<br ?\/?>/g,"\n").replace(/(<[^>]*>)|(&nbsp;)/g,"").replace(/&amp;/gi,"&"):a}),this.visible=c._getset("_visible"),this.number=c._getset("_number"),this.files=c._getset("_files")}return a._convertRaw=function(a,b){var d,e;return e=new c.StudyGuidePart(a),e._id=b.Id,e._from=new Date(Date.parse(b.Van)),e._to=new Date(Date.parse(b.TotEnMet)),e._name=b.Titel,e._description=b.Omschrijving,e._visible=b.IsZichtbaar,e._number=b.Volgnummer,e._files=function(){var e,f,g,h;for(g=b.Bronnen,h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(c.File._convertRaw(a,void 0,d));return h}(),e},a}(),c=null!=(j="undefined"!=typeof module&&null!==module?module.exports:void 0)?j:null!=this.Magister?this.Magister:this.Magister={},c._helpers=function(){function a(){}return a.addZero=function(a){return 10>a?"0"+a:a.toString()},a.toUtcString=function(b){return""+a.addZero(b.getUTCFullYear())+"-"+a.addZero(b.getMonth()+1)+"-"+a.addZero(b.getDate())+"T"+a.addZero(b.getHours())+":"+a.addZero(b.getMinutes())+":"+a.addZero(b.getSeconds())+".0000000Z"},a.pushMore=function(a,b){return[].push.apply(a,b),a},a.contains=function(a,b,c){return null==c&&(c=!1),c?a.toUpperCase().indexOf(b.toUpperCase())>=0:a.indexOf(b)>=0},a.asyncResultWaiter=function(b,c){var e,f;return 0===b&&c([]),f=[],e=b,function(b){return d.isArray(b)?(a.pushMore(f,b),e-=b.length):(f.push(b),e--),0===e?c(f):void 0}},a.trim=function(a){return null==a||0===a.length?"":d.isFunction(String.prototype.trim)?a.trim():a.replace(/^\s+|\s+$/g,"")},a.saveFile=function(a,b,c){try{return saveAs(new Blob([a],{type:b}),c)}catch(d){}},a.urlDateConvert=function(b){return""+b.getUTCFullYear()+"-"+a.addZero(b.getMonth()+1)+"-"+a.addZero(b.getDate())},a.date=function(a){return new Date(a.getUTCFullYear(),a.getMonth(),a.getDate())},a}(),c._getset=function(a,b,c){return function(e){if(null!=e){if(!d.isFunction(b))throw new Error("Changes on this property aren't allowed");b(e,!0)}return d.isFunction(c)?c(this[a],!1):this[a]}},null==Array.isArray&&(d.isArray=jQuery.isArray=Array.isArray=function(a){return Object.prototype.toString.call("[object Array]"===a)}),!function(a){"use strict";if(a.URL=a.URL||a.webkitURL,a.Blob&&a.URL)try{return void new Blob}catch(b){}var c=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||function(a){var b=function(a){return Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1]},c=function(){this.data=[]},d=function(a,b,c){this.data=a,this.size=a.length,this.type=b,this.encoding=c},e=c.prototype,f=d.prototype,g=a.FileReaderSync,h=function(a){this.code=this[this.name=a]},i="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),j=i.length,k=a.URL||a.webkitURL||a,l=k.createObjectURL,m=k.revokeObjectURL,n=k,o=a.btoa,p=a.atob,q=a.ArrayBuffer,r=a.Uint8Array,s=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(d.fake=f.fake=!0;j--;)h.prototype[i[j]]=j+1;return k.createObjectURL||(n=a.URL=function(a){var b,c=document.createElementNS("http://www.w3.org/1999/xhtml","a");return c.href=a,"origin"in c||("data:"===c.protocol.toLowerCase()?c.origin=null:(b=a.match(s),c.origin=b&&b[1])),c}),n.createObjectURL=function(a){var b,c=a.type;return null===c&&(c="application/octet-stream"),a instanceof d?(b="data:"+c,"base64"===a.encoding?b+";base64,"+a.data:"URI"===a.encoding?b+","+decodeURIComponent(a.data):o?b+";base64,"+o(a.data):b+","+encodeURIComponent(a.data)):l?l.call(k,a):void 0},n.revokeObjectURL=function(a){"data:"!==a.substring(0,5)&&m&&m.call(k,a)},e.append=function(a){var c=this.data;if(r&&(a instanceof q||a instanceof r)){for(var e="",f=new r(a),i=0,j=f.length;j>i;i++)e+=String.fromCharCode(f[i]);c.push(e)}else if("Blob"===b(a)||"File"===b(a)){if(!g)throw new h("NOT_READABLE_ERR");var k=new g;c.push(k.readAsBinaryString(a))}else a instanceof d?"base64"===a.encoding&&p?c.push(p(a.data)):"URI"===a.encoding?c.push(decodeURIComponent(a.data)):"raw"===a.encoding&&c.push(a.data):("string"!=typeof a&&(a+=""),c.push(unescape(encodeURIComponent(a))))},e.getBlob=function(a){return arguments.length||(a=null),new d(this.data.join(""),a,"raw")},e.toString=function(){return"[object BlobBuilder]"},f.slice=function(a,b,c){var e=arguments.length;return 3>e&&(c=null),new d(this.data.slice(a,e>1?b:this.data.length),c,this.encoding)},f.toString=function(){return"[object Blob]"},f.close=function(){this.size=0,delete this.data},c}(a);a.Blob=function(a,b){var d=b?b.type||"":"",e=new c;if(a)for(var f=0,g=a.length;g>f;f++)e.append(a[f]);return e.getBlob(d)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),saveAs=void 0;try{saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=b.createElementNS("http://www.w3.org/1999/xhtml","a"),d="download"in c,e=function(c){var d=b.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)},f=a.webkitRequestFileSystem,g=a.requestFileSystem||f||a.mozRequestFileSystem,h=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},i=0,j=function(b){var c=function(){"string"==typeof b?(a.URL||a.webkitURL||a).revokeObjectURL(b):b.remove()};a.chrome?c():setTimeout(c,10)},k=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){h(f)}}},l=function(b,h){var l,m,n,o=this,p=b.type,q=!1,r=function(){k(o,["writestart","progress","write","writeend"])},s=function(){(q||!l)&&(l=(a.URL||a.webkitURL||a).createObjectURL(b)),m?m.location.href=l:void 0==a.open(l,"_blank")&&"undefined"!=typeof safari&&(a.location.href=l),o.readyState=o.DONE,r(),j(l)},t=function(a){return function(){return o.readyState!==o.DONE?a.apply(this,arguments):void 0}},u={create:!0,exclusive:!1};o.readyState=o.INIT,h||(h="download"),d?(l=(a.URL||a.webkitURL||a).createObjectURL(b),c.href=l,c.download=h,e(c),o.readyState=o.DONE,r(),j(l)):(a.chrome&&p&&"application/octet-stream"!==p&&(n=b.slice||b.webkitSlice,b=n.call(b,0,b.size,"application/octet-stream"),q=!0),f&&"download"!==h&&(h+=".download"),("application/octet-stream"===p||f)&&(m=a),g?(i+=b.size,g(a.TEMPORARY,i,t(function(a){a.root.getDirectory("saved",u,t(function(a){var c=function(){a.getFile(h,u,t(function(a){a.createWriter(t(function(c){c.onwriteend=function(b){m.location.href=a.toURL(),o.readyState=o.DONE,k(o,"writeend",b),j(a)},c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&s()},["writestart","progress","write","abort"].forEach(function(a){c["on"+a]=o["on"+a]}),c.write(b),o.abort=function(){c.abort(),o.readyState=o.DONE},o.readyState=o.WRITING}),s)}),s)};a.getFile(h,{create:!1},t(function(a){a.remove(),c()}),t(function(a){a.code===a.NOT_FOUND_ERR?c():s()}))}),s)}),s)):s())},m=l.prototype;return m.abort=function(){this.readyState=this.DONE,k(this,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,function(a,b){return new l(a,b)}}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content),"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs})}catch(t){}}).call(this);