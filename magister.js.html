<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>magister.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AbsenceInfo.html">AbsenceInfo</a><ul class='methods'><li data-type='method'><a href="AbsenceInfo.html#toJSON">toJSON</a></li></ul></li><li><a href="Activity.html">Activity</a><ul class='methods'><li data-type='method'><a href="Activity.html#elements">elements</a></li><li data-type='method'><a href="Activity.html#toJSON">toJSON</a></li></ul></li><li><a href="ActivityElement.html">ActivityElement</a><ul class='methods'><li data-type='method'><a href="ActivityElement.html#_toMagister">_toMagister</a></li><li data-type='method'><a href="ActivityElement.html#signup">signup</a></li><li data-type='method'><a href="ActivityElement.html#toJSON">toJSON</a></li></ul></li><li><a href="AddressInfo.html">AddressInfo</a><ul class='methods'><li data-type='method'><a href="AddressInfo.html#toJSON">toJSON</a></li></ul></li><li><a href="Appointment.html">Appointment</a><ul class='methods'><li data-type='method'><a href="Appointment.html#_toMagister">_toMagister</a></li><li data-type='method'><a href="Appointment.html#attachments">attachments</a></li><li data-type='method'><a href="Appointment.html#remove">remove</a></li><li data-type='method'><a href="Appointment.html#saveChanges">saveChanges</a></li><li data-type='method'><a href="Appointment.html#toJSON">toJSON</a></li></ul></li><li><a href="Assignment.html">Assignment</a><ul class='methods'><li data-type='method'><a href="Assignment.html#toJSON">toJSON</a></li><li data-type='method'><a href="Assignment.html#versions">versions</a></li></ul></li><li><a href="AssignmentVersion.html">AssignmentVersion</a><ul class='methods'><li data-type='method'><a href="AssignmentVersion.html#toJSON">toJSON</a></li></ul></li><li><a href="AuthError.html">AuthError</a><ul class='methods'><li data-type='method'><a href="AuthError.html#toString">toString</a></li></ul></li><li><a href="Class.html">Class</a><ul class='methods'><li data-type='method'><a href="Class.html#toJSON">toJSON</a></li></ul></li><li><a href="Course.html">Course</a><ul class='methods'><li data-type='method'><a href="Course.html#classes">classes</a></li><li data-type='method'><a href="Course.html#grades">grades</a></li><li data-type='method'><a href="Course.html#toJSON">toJSON</a></li></ul></li><li><a href="File.html">File</a><ul class='methods'><li data-type='method'><a href="File.html#_toMagister">_toMagister</a></li><li data-type='method'><a href="File.html#download">download</a></li><li data-type='method'><a href="File.html#remove">remove</a></li><li data-type='method'><a href="File.html#saveChanges">saveChanges</a></li><li data-type='method'><a href="File.html#toJSON">toJSON</a></li></ul></li><li><a href="FileFolder.html">FileFolder</a><ul class='methods'><li data-type='method'><a href="FileFolder.html#files">files</a></li><li data-type='method'><a href="FileFolder.html#toJSON">toJSON</a></li></ul></li><li><a href="Grade.html">Grade</a><ul class='methods'><li data-type='method'><a href="Grade.html#fill">fill</a></li><li data-type='method'><a href="Grade.html#toJSON">toJSON</a></li></ul></li><li><a href="GradePeriod.html">GradePeriod</a><ul class='methods'><li data-type='method'><a href="GradePeriod.html#toJSON">toJSON</a></li></ul></li><li><a href="GradeType.html">GradeType</a><ul class='methods'><li data-type='method'><a href="GradeType.html#toJSON">toJSON</a></li></ul></li><li><a href="Http.html">Http</a><ul class='methods'><li data-type='method'><a href="Http.html#_enqueue">_enqueue</a></li><li data-type='method'><a href="Http.html#_request">_request</a></li><li data-type='method'><a href="Http.html#_setRatelimitTime">_setRatelimitTime</a></li><li data-type='method'><a href="Http.html#delete">delete</a></li><li data-type='method'><a href="Http.html#get">get</a></li><li data-type='method'><a href="Http.html#makeRequest">makeRequest</a></li><li data-type='method'><a href="Http.html#post">post</a></li><li data-type='method'><a href="Http.html#put">put</a></li></ul></li><li><a href="Magister.html">Magister</a><ul class='methods'><li data-type='method'><a href="Magister.html#activities">activities</a></li><li data-type='method'><a href="Magister.html#appointments">appointments</a></li><li data-type='method'><a href="Magister.html#assignments">assignments</a></li><li data-type='method'><a href="Magister.html#children">children</a></li><li data-type='method'><a href="Magister.html#courses">courses</a></li><li data-type='method'><a href="Magister.html#createAppointment">createAppointment</a></li><li data-type='method'><a href="Magister.html#fileFolders">fileFolders</a></li><li data-type='method'><a href="Magister.html#login">login</a></li><li data-type='method'><a href="Magister.html#messageFolders">messageFolders</a></li><li data-type='method'><a href="Magister.html#persons">persons</a></li></ul></li><li><a href="MagisterError.html">MagisterError</a><ul class='methods'><li data-type='method'><a href="MagisterError.html#toString">toString</a></li></ul></li><li><a href="MagisterThing.html">MagisterThing</a><ul class='methods'><li data-type='method'><a href="MagisterThing.html#toJSON">toJSON</a></li></ul></li><li><a href="Message.html">Message</a><ul class='methods'><li data-type='method'><a href="Message.html#_toMagister">_toMagister</a></li><li data-type='method'><a href="Message.html#addRecipient">addRecipient</a></li><li data-type='method'><a href="Message.html#fill">fill</a></li><li data-type='method'><a href="Message.html#remove">remove</a></li><li data-type='method'><a href="Message.html#saveChanges">saveChanges</a></li><li data-type='method'><a href="Message.html#send">send</a></li><li data-type='method'><a href="Message.html#toJSON">toJSON</a></li></ul></li><li><a href="MessageFolder.html">MessageFolder</a><ul class='methods'><li data-type='method'><a href="MessageFolder.html#messages">messages</a></li><li data-type='method'><a href="MessageFolder.html#toJSON">toJSON</a></li></ul></li><li><a href="Person.html">Person</a><ul class='methods'><li data-type='method'><a href="Person.html#_toMagister">_toMagister</a></li><li data-type='method'><a href="Person.html#getFilled">getFilled</a></li><li data-type='method'><a href="Person.html#toJSON">toJSON</a></li></ul></li><li><a href="Privileges.html">Privileges</a></li><li><a href="ProfileInfo.html">ProfileInfo</a><ul class='methods'><li data-type='method'><a href="ProfileInfo.html#address">address</a></li><li data-type='method'><a href="ProfileInfo.html#getFullName">getFullName</a></li><li data-type='method'><a href="ProfileInfo.html#getProfilePicture">getProfilePicture</a></li><li data-type='method'><a href="ProfileInfo.html#settings">settings</a></li><li data-type='method'><a href="ProfileInfo.html#toJSON">toJSON</a></li></ul></li><li><a href="ProfileSettings.html">ProfileSettings</a><ul class='methods'><li data-type='method'><a href="ProfileSettings.html#_toMagister">_toMagister</a></li><li data-type='method'><a href="ProfileSettings.html#changePassword">changePassword</a></li><li data-type='method'><a href="ProfileSettings.html#saveChanges">saveChanges</a></li><li data-type='method'><a href="ProfileSettings.html#toJSON">toJSON</a></li></ul></li><li><a href="School.html">School</a><ul class='methods'><li data-type='method'><a href="School.html#versionInfo">versionInfo</a></li></ul></li><li><a href="SchoolUtility.html">SchoolUtility</a><ul class='methods'><li data-type='method'><a href="SchoolUtility.html#toJSON">toJSON</a></li></ul></li><li><a href="global.html#VersionInfo">VersionInfo</a></li></ul><h3>Global</h3><ul><li><a href="global.html#can">can</a></li><li><a href="global.html#getSchools">getSchools</a></li><li><a href="global.html#needs">needs</a></li><li><a href="global.html#VERSION">VERSION</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">magister.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

// external
import _ from 'lodash'
import fetch from 'node-fetch'
import url from 'url'

// internal: used in this file
import AbsenceInfo from './absenceInfo'
import Activity from './activity'
import Appointment from './appointment'
import Assignment from './assignment'
import AuthError from './authError'
import Class from './class'
import Course from './course'
import FileFolder from './fileFolder'
import Http from './http'
import MessageFolder from './messageFolder'
import Person from './person'
import Privileges from './privileges'
import ProfileInfo from './profileInfo'
import School from './school'
import SchoolUtility from './schoolUtility'
import * as util from './util'

// internal: only being exported
import ActivityElement from './activityElement'
import AddressInfo from './addressInfo'
import AssignmentVersion from './assignmentVersion'
import File from './file'
import Grade from './grade'
import GradePeriod from './gradePeriod'
import GradeType from './gradeType'
import Message from './message'
import ProfileSettings from './profileSettings'
import VersionInfo from './versionInfo'

// TODO: add nice warnings when trying to do stuff while not logged in yet

/**
 * Class to communicate with Magister.
 * @private
 */
class Magister {
	/**
	 * @param {Object} options
	 * @param {School} school
	 * @param {Http} http
	 */
	constructor(options, school, http) {
		const info = url.parse(school.url)
		if (!/^[a-z0-9]+\.magister\.net$/.test(info.host)) {
			throw new Error('`school.url` is not a correct magister url')
		}
		school.url = `https://${info.host}`


		/**
		 * @type Object
		 * @readonly
		 * @private
		 */
		this._options = options
		/**
		 * @type School
		 * @readonly
		 */
		this.school = _.extend(new School({}), school)
		/**
		 * @type Http
		 * @readonly
		 */
		this.http = http
		/**
		 * @type ProfileInfo
		 * @readonly
		 */
		this.profileInfo = null
	}

	/**
	 * @return {Promise&lt;Activity[]>}
	 */
	activities() {
		return this._privileges.needs('activiteiten', 'read')
		.then(() => this.http.get(`${this._personUrl}/activiteiten`))
		.then(res => res.json())
		.then(res => res.Items.map(a => new Activity(this, a)))
	}

	/**
	 * @param {Date} from Time is ignored.
	 * @param {Date} [to=from] Time is ignored
	 * @param {Object} [options={}]
	 * 	@param {Boolean} [options.fillPersons=false]
	 * 	@param {Boolean} [options.fetchAbsences=true]
	 * 	@param {Boolean} [options.ignoreAbsenceErrors=true]
	 * @return {Promise&lt;Appointment[]>}
	 */
	appointments() {
		// extract options
		const {
			fillPersons = false,
			fetchAbsences = true,
			ignoreAbsenceErrors = true,
		} = _.find(arguments, _.isPlainObject) || {}

		// extract dates
		const dates = _(arguments).filter(_.isDate).sortBy().value()
		const from = dates[0]
		const to = dates[1] || dates[0]

		const fromUrl = util.urlDateConvert(from)
		const toUrl = util.urlDateConvert(to)

		// fetch appointments
		const appointmentsUrl = `${this._personUrl}/afspraken?van=${fromUrl}&amp;tot=${toUrl}`
		const appointmentsPromise = this._privileges.needs('afspraken', 'read')
		.then(() => this.http.get(appointmentsUrl))
		.then(res => res.json())
		.then(res => res.Items.map(a => new Appointment(this, a)))
		.then(appointments => {
			if (!fillPersons) {
				return appointments
			}

			const promises = appointments.map(a => {
				return Promise.all(a.teachers.map(t => t.getFilled('teacher')))
				.then(teachers => a.teachers = teachers)
				.then(() => a)
			})
			return Promise.all(promises)
		})

		// fetch absences
		let absencesPromise = Promise.resolve([])
		if (fetchAbsences) {
			const absencesUrl = `${this._personUrl}/absenties?van=${fromUrl}&amp;tot=${toUrl}`
			absencesPromise = this._privileges.needs('Absenties', 'read')
			.then(() => this.http.get(absencesUrl))
			.then(res => res.json())
			.then(res => res.Items.map(a => new AbsenceInfo(this, a)))

			if (ignoreAbsenceErrors) {
				absencesPromise = absencesPromise.catch(() => [])
			}
		}

		return Promise.all([ appointmentsPromise, absencesPromise ])
		.then(([ appointments, absences ]) => {
			for (const a of appointments) {
				a.absenceInfo = absences.find(i => i.appointment.id === a.id)
			}

			return appointments
		})
		.then(appointments => _.sortBy(appointments, 'start'))
	}

	/**
	 * @param {Object} [options={}]
	 * 	@param {Number} [options.count=50]
	 * 	@param {Number} [options.skip=0]
	 * 	@param {Boolean} [options.fillPersons=false]
	 * @return {Promise&lt;Assignment[]>}
	 */
	assignments({
		count = 50,
		skip = 0,
		fillPersons = false,
	} = {}) {
		const url = `${this._personUrl}/opdrachten?top=${count}&amp;skip=${skip}&amp;status=alle`

		return this._privileges.needs('eloopdracht', 'read')
		.then(() => this.http.get(url))
		.then(res => res.json())
		.then(res => res.Items.map(i => i.Id))
		.then(ids => {
			const promises = ids.map(id => {
				return this.http.get(`${this._personUrl}/opdrachten/${id}`)
				.then(res => res.json())
			})
			return Promise.all(promises)
		})
		.then(items => {
			const promises = items.map(item => {
				const assignment = new Assignment(this, item)
				if (!fillPersons) {
					return assignment
				}

				return Promise.all(assignment.teachers.map(p => p.getFilled('teacher')))
				.then(teachers => assignment.teachers = teachers)
				.then(() => assignment)
			})
			return Promise.all(promises)
		})
	}

	/**
	 * @return {Promise&lt;Magister[]>}
	 */
	children() {
		if (this.profileInfo.isChild) {
			return Promise.reject(new Error('User is not a parent'))
		}

		return this.http.get(`${this._personUrl}/kinderen`)
		.then(res => res.json())
		.then(res => res.Items)
		.then(items => items.map(raw => {
			const m = Object.create(this)

			m.school = this.school
			m.http = this.http

			m._personUrl = `${this.school.url}/api/personen/${raw.Id}`
			m._pupilUrl = `${this.school.url}/api/leerlingen/${raw.Id}`
			m.profileInfo = new ProfileInfo(m, raw)

			return m
		}))
	}

	/**
	 * @return {Promise&lt;Course>}
	 */
	courses() {
		return this._privileges.needs('aanmeldingen', 'read')
		.then(() => this.http.get(`${this._personUrl}/aanmeldingen`))
		.then(res => res.json())
		.then(res => res.Items.map(c => new Course(this, c)))
		.then(items => _.sortBy(items, 'start'))
	}

	/**
	 * @param {Object} options
	 * 	@param {String} options.description The description of the appointment.
	 * 	@param {Date} options.start The start of the appointment, time is
	 * 	ignored when `options.fullDay` is set to true.
	 * 	@param {Date} options.end The end of the appointment, this is ignored
	 * 	when `options.fullDay` is set to true.
	 * 	@param {Boolean} [options.fullDay=false] When this is true,
	 * 	`options.end` is ignored and only `options.start` is used to set the
	 * 	begin and the end for the appointment.
	 * 	@param {String} [options.location] The location (classroom for example)
	 * 	for the appointment.
	 * 	@param {String} [options.content] Some arbitrary string you want to
	 * 	save.
	 * 	@param {Number} [options.type=1] The type of the appointment: 1 for
	 * 	personal or 16 for planning
	 * @return {Promise}
	 */
	createAppointment(options) {
		const required = [ 'description', 'start', 'end' ]
		for (const key of required) {
			if (options[key] == null) {
				const err = new Error(`Not all required fields for \`options\` are given, required are: [ ${required.join(', ')} ]`)
				return Promise.reject(err)
			}
		}

		if (options.fullDay) {
			options.start = util.date(options.start)
			options.end = new Date(options.start.getTime()) + 1000 * 60 * 60 * 24
		}

		const payload = {
			Omschrijving: options.description,
			Start: options.start.toJSON(),
			Einde: options.end.toJSON(),

			Lokatie: _.trim(options.location),
			Inhoud: (function () {
				const content = _.trim(options.content)
				return content.length > 0 ? _.escape(content) : null
			})(),
			Type: options.type || 1,
			DuurtHeleDag: options.fullDay || false,

			// Static non-configurable stuff.
			InfoType: 0,
			WeergaveType: 1,
			Status: 2,
			HeeftBijlagen: false,
			Bijlagen: null,
			LesuurVan: null,
			LesuurTotMet: null,
			Aantekening: null,
			Afgerond: false,
			Vakken: null,
			Docenten: null,
			Links: null,
			Id: 0,
			Lokalen: null,
			Groepen: null,
			OpdrachtId: 0,
		}

		return this._privileges.needs('afspraken', 'create')
		.then(() => this.http.post(`${this._personUrl}/afspraken`, payload))
	}

	/**
	 * @return {Promise&lt;FileFolder[]>}
	 */
	fileFolders() {
		return this._privileges.needs('bronnen', 'read')
		.then(() => this.http.get(`${this._personUrl}/bronnen?soort=0`))
		.then(res => res.json())
		.then(res => res.Items.map(f => new FileFolder(this, f)))
	}

	/**
	 * @return {Promise&lt;MessageFolder[]>}
	 */
	messageFolders() {
		return this._privileges.needs('berichten', 'read')
		.then(() => this.http.get(`${this._personUrl}/berichten/mappen`))
		.then(res => res.json())
		.then(res => res.Items.map(m => new MessageFolder(this, m)))
	}

	/**
	 * @param {String} query
	 * @param {String} [type]
	 * @return {Promise&lt;Person[]>}
	 */
	persons(query, type) {
		query = query != null ? query.trim() : ''

		if (query.length &lt; 3) {
			return Promise.resolve([])
		} else if (type == null) {
			return Promise.all([
				this.persons(query, 'teacher'),
				this.persons(query, 'pupil'),
			]).then(([ teachers, pupils ]) => teachers.concat(pupils))
		}

		type = ({
			'teacher': 'Personeel',
			'pupil': 'Leerling',
			'project': 'Project',
		})[type] || 'Overig'
		query = query.replace(/ +/g, '+')

		const url = `${this._personUrl}/contactpersonen?contactPersoonType=${type}&amp;q=${query}`

		return this._privileges.needs('contactpersonen', 'read')
		.then(() => this.http.get(url))
		.then(res => res.json())
		.then(res => res.Items.map(p => {
			p = new Person(this, p)
			p._filled = true
			return p
		}))
	}

	schoolUtilities() {
		const url = `${this._personUrl}/lesmateriaal`

		return this._privileges.needs('digitaallesmateriaal', 'read')
		.then(() => this.http.get(url))
		.then(res => res.json())
		.then(res => res.Items.map(u => new SchoolUtility(this, u)))
	}

	/**
	 * Logins to Magister.
	 * @param {Boolean} [forceLogin=false] Force a login, even when a token
	 * is in the options object.
	 * @return {Promise&lt;String>} A promise that resolves when done logging in. With the current session ID as parameter.
	 */
	async login(forceLogin = false) {
		const self = this

		function setToken (token) {
			self.http._token = token
			return token
		}

		const options = this._options
		const schoolUrl = this.school.url
		const filteredName = schoolUrl.split('https://').join('')

		let authorizeUrl = 'https://accounts.magister.net/connect/authorize'
		authorizeUrl += `?client_id=M6-${filteredName}`
		authorizeUrl += `&amp;redirect_uri=https%3A%2F%2F${filteredName}%2Foidc%2Fredirect_callback.html`
		authorizeUrl += '&amp;response_type=id_token%20token'
		authorizeUrl += '&amp;scope=openid%20profile%20magister.ecs.legacy%20magister.mdv.broker.read%20magister.dnn.roles.read'
		authorizeUrl += '&amp;state=29302702b955469f84d342fcb4cece33'
		authorizeUrl += '&amp;nonce=8cfe9935b3a14fc593f328663d14f191'
		authorizeUrl += `&amp;acr_values=tenant%3A${filteredName}`

		if (!forceLogin &amp;&amp; options.token) {
			return setToken(options.token)
		}

		// extract returnUrl
		const location = await this.http.get(authorizeUrl, {
			redirect: 'manual',
		}).then(res => res.headers.get('Location'))

		const returnUrl = decodeURIComponent(
			location.split('returnUrl=')[1]
		)

		// extract session and XSRF related stuff
		const xsrfResponse = await this.http.get(location, {
			redirect: 'manual',
		})

		const sessionId =
			xsrfResponse.headers.get('Location')
			.split('?')[1]
			.split('&amp;')[0]
			.split('=')[1]
		const authUrl = 'https://accounts.magister.net/challenge'
		const xsrf =
			xsrfResponse.headers.get('set-cookie')
			.split('XSRF-TOKEN=')[1]
			.split(';')[0]
		const authCookies = xsrfResponse.headers.get('set-cookie').toString()
		let authRes

		try {
			// test username
			authRes = await this.http.post(`${authUrl}/username`, {
				sessionId: sessionId,
				returnUrl: returnUrl,
				username: options.username,
			}, {
				headers: {
					Cookie: authCookies,
					'X-XSRF-TOKEN': xsrf,
				},
			})
			if (authRes.error) {
				throw authRes.error
			}

			// test password
			authRes = await this.http.post(`${authUrl}/password`, {
				sessionId: sessionId,
				returnUrl: returnUrl,
				password: options.password,
			}, {
				headers: {
					Cookie: authCookies,
					'X-XSRF-TOKEN': xsrf,
				},
			})
			if (authRes.error) {
				throw authRes.error
			}
		} catch (err) {
			throw new AuthError(err)
		}

		// extract bearer token
		const token =
			await this.http.get(`https://accounts.magister.net${returnUrl}`, {
				redirect: 'manual',
				headers: {
					Cookie: authRes.headers.get('set-cookie'),
					'X-XSRF-TOKEN': xsrf,
				},
			})
			.then(res => res.headers.get('Location')
			.split('&amp;access_token=')[1]
			.split('&amp;')[0])
			.then(setToken)
		const accountData = await
			this.http.get(`${schoolUrl}/api/account`)
			.then(res => res.json())
		const id = accountData.Persoon.Id

		// REVIEW: do we want to make profileInfo a function?
		this.profileInfo = new ProfileInfo(this, accountData.Persoon)
		this._privileges = new Privileges(this, accountData.Groep[0].Privileges)

		this._personUrl = `${schoolUrl}/api/personen/${id}`
		this._pupilUrl = `${schoolUrl}/api/leerlingen/${id}`

		return token
	}
}

/**
 * Create a new Magister object using `options`.
 * @param {Object} options
 * 	@param {School} options.school The school to login to.
 * 	@param {String} [options.username] The username of the user to login to.
 * 	@param {String} [options.password] The password of the user to login to.
 * 	@param {String} [options.token] The Bearer token to use. (instead of the username and password)
 * 	@param {Boolean} [options.keepLoggedIn=true] Whether or not to keep the user logged in.
 * 	@param {Boolean} [options.login=true] Whether or not to call `Magister#login` before returning the object.
 * @return {Promise&lt;Magister>}
 */
export default function magister(options) {
	_.defaults(options, {
		keepLoggedIn: true,
		login: true,
	})
	const rej = s => Promise.reject(new Error(s))

	if (!(
		options.school &amp;&amp;
		(options.token || (options.username &amp;&amp; options.password))
	)) {
		return rej('school and username&amp;password or token are required.')
	}

	if (!_.isObject(options.school)) {
		return rej('school is not an object')
	} else if (!_.isString(options.school.url)) {
		return rej('`school.url` is not a string')
	}

	return Promise.resolve().then(() => {
		const m = new Magister(options, options.school, new Http())

		return options.login ?
			m.login().then(() => m) :
			m
	})
}

/**
 * Get the schools matching `query`.
 * @param {String} query
 * @return {Promise&lt;School[]>}
 */
export function getSchools(query) {
	query = query.replace(/\d/g, '')
	query = query.trim()
	query = query.replace(/ +/g, '+')

	if (query.length &lt; 3) {
		return Promise.resolve([])
	}

	return fetch(`https://mijn.magister.net/api/schools?filter=${query}`)
	.then(res => res.json())
	.then(schools => schools.map(school => new School(school)))
}

/**
 * The version of the library.
 * @type String
 * @readonly
 */
export const VERSION = __VERSION__
export {
	AbsenceInfo,
	Activity,
	ActivityElement,
	AddressInfo,
	Appointment,
	Assignment,
	AssignmentVersion,
	AuthError,
	Class,
	Course,
	File,
	FileFolder,
	Grade,
	GradePeriod,
	GradeType,
	Magister,
	Message,
	MessageFolder,
	Person,
	Privileges,
	ProfileInfo,
	ProfileSettings,
	School,
	SchoolUtility,
	VersionInfo,
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Nov 05 2018 13:20:53 GMT+0100 (Central European Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>


</body>
</html>
